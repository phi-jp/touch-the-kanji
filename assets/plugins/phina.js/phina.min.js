!function(){Object.defineProperty(Object.prototype,"property",{value:function(t,i){Object.defineProperty(this,t,{value:i,enumerable:!0,writable:!0})}}),Object.defineProperty(Object.prototype,"method",{value:function(t,i){Object.defineProperty(this,t,{value:i,enumerable:!1,writable:!0})}}),Object.prototype.method("setter",function(t,i){Object.defineProperty(this,t,{set:i,enumerable:!1,configurable:!0})}),Object.prototype.method("getter",function(t,i){Object.defineProperty(this,t,{get:i,enumerable:!1,configurable:!0})}),Object.prototype.method("accessor",function(t,i){Object.defineProperty(this,t,{set:i.set,get:i.get,enumerable:!1,configurable:!0})}),Object.prototype.method("forIn",function(t,i){return i=i||this,Object.keys(this).forEach(function(e,n){var s=this[e];t.call(i,e,s,n)},this),this}),Object.prototype.method("$has",function(t){return this.hasOwnProperty(t)}),Object.prototype.method("$extend",function(){return Array.prototype.forEach.call(arguments,function(t){for(var i in t)this[i]=t[i]},this),this}),Object.prototype.method("$safe",function(t){return Array.prototype.forEach.call(arguments,function(t){for(var i in t)void 0===this[i]&&(this[i]=t[i])},this),this}),Object.prototype.method("$strict",function(t){return Array.prototype.forEach.call(arguments,function(t){for(var i in t)console.assert(!this[i],"tm error: {0} is Already".format(i)),this[i]=t[i]},this),this}),Object.prototype.method("$pick",function(){var t={};return Array.prototype.forEach.call(arguments,function(i){i in this&&(t[i]=this[i])},this),t}),Object.prototype.method("$omit",function(){var t={};for(var i in this)-1==Array.prototype.indexOf.call(arguments,i)&&(t[i]=this[i]);return t}),Object.observe||Object.method("observe",function(t,i){var e=Object.keys(t);e.forEach(function(e){var n="__"+e,s=t[e];t[n]=s,t.accessor(e,{get:function(){return this[n]},set:function(t){this[n]=t,i()}})})}),Object.unobserve||Object.method("unobserve",function(t,i){console.assert(!1)})}(),function(){Number.prototype.method("times",function(t,i){i=i||this;for(var e=0;this>e;++e)t.call(i,e);return this})}(),function(){String.prototype.method("format",function(t){var i=void 0;if("object"==typeof t)i=function(i,e){return void 0===t[e]?"":t[e]};else{var e=arguments;i=function(t,i){return e[parseInt(i)]}}return this.replace(/\{(\w+)\}/g,i)}),String.prototype.method("trim",function(){return this.replace(/^\s+|\s+$/g,"")}),String.prototype.method("capitalize",function(){return this.replace(/\w+/g,function(t){return t.capitalizeFirstLetter()})}),String.prototype.method("capitalizeFirstLetter",function(){return this.charAt(0).toUpperCase()+this.substr(1).toLowerCase()}),String.prototype.method("toDash",function(){return this.replace(/([A-Z])/g,function(t){return"-"+t.toLowerCase()})}),String.prototype.method("toHash",function(){return this.toCRC32()}),String.prototype.method("padding",function(t,i){var e=this.toString();for(t-=e.length,i=i||" ";t-->0;)e=i+e;return e}),String.prototype.method("paddingLeft",function(t,i){var e=this.toString();for(t-=e.length,i=i||" ";t-->0;)e=i+e;return e}),String.prototype.method("paddingRight",function(t,i){var e=this.toString();for(t-=e.length,i=i||" ";t-->0;)e+=i;return e}),String.prototype.method("quotemeta",function(t){return this.replace(/([^0-9A-Za-z_])/g,"\\$1")}),String.prototype.method("repeat",function(t){for(var i=Array(t),e=0;t>e;++e)i[e]=this;return i.join("")}),String.prototype.method("count",function(t){var i=new RegExp(t,"gm");return this.match(i).length}),String.prototype.method("include",function(t){return-1!=this.indexOf(t)}),String.prototype.method("toArray",function(){for(var t=[],i=0,e=this.length;e>i;++i)t.push(this[i]);return t}),String.prototype.method("toObject",function(t,i){t=t||"&",i=i||"=";var e={},n=this.split(t);return n.each(function(t,n){var s=t.indexOf(i);if(s>0){var a=t.substring(0,s),r=t.substring(s+1),h=Number(r);isNaN(h)?"true"===r?r=!0:"false"===r&&(r=!1):r=h,e[a]=r}}),e});var t="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D".split(" ");String.prototype.method("toCRC32",function(){var i=0,e=0,n=0;i=-1^i;for(var s=0,a=this.length;a>s;++s)n=255&(i^this.charCodeAt(s)),e="0x"+t[n],i=i>>>8^e;return(-1^i)>>>0})}(),function(){Array.prototype.accessor("first",{get:function(){return this[0]},set:function(t){this[0]=t}}),Array.prototype.accessor("last",{get:function(){return this[this.length-1]},set:function(t){this[this.length-1]=t}}),Array.prototype.method("equals",function(t){if(this.length!==t.length)return!1;for(var i=0,e=this.length;e>i;++i)if(this[i]!==t[i])return!1;return!0}),Array.prototype.method("deepEquals",function(t){if(this.length!==t.length)return!1;for(var i=0,e=this.length;e>i;++i){var n=this[i].deepEquals?this[i].deepEquals(t[i]):this[i]===t[i];if(n===!1)return!1}return!0}),Array.prototype.method("contains",function(t,i){return-1!=this.indexOf(t,i)}),Array.prototype.method("at",function(t){return t%=this.length,t+=this.length,t%=this.length,this[t]}),Array.prototype.method("find",function(t,i){var e=null;return this.some(function(n,s){return t.call(i,n,s,this)?(e=n,!0):void 0}),e}),Array.prototype.method("findIndex",function(t,i){var e=null;return this.some(function(n,s){return t.call(i,n,s,this)?(e=s,!0):void 0}),e}),Array.prototype.method("swap",function(t,i){var e=this[t];return this[t]=this[i],this[i]=e,this}),Array.prototype.method("erase",function(t){var i=this.indexOf(t);return i>=0&&this.splice(i,1),this}),Array.prototype.method("eraseAll",function(t){for(var i=0,e=this.length;e>i;++i)this[i]==t&&this.splice(i--,1);return this}),Array.prototype.method("eraseIf",function(t){for(var i=0,e=this.length;e>i;++i)if(t(this[i],i,this)){this.splice(i,1);break}return this}),Array.prototype.method("eraseIfAll",function(t){for(var i=0,e=this.length;e>i;++i)t(this[i],i,this)&&(this.splice(i--,1),e--);return this}),Array.prototype.method("random",function(t,i){return t=t||0,i=i||this.length-1,this[Math.rand(t,i)]}),Array.prototype.method("pickup",function(t,i){return t=t||0,i=i||this.length-1,this[Math.rand(t,i)]}),Array.prototype.method("lot",function(t,i){return t=t||0,i=i||this.length-1,this[Math.rand(t,i)]}),Array.prototype.method("uniq",function(t){return this.filter(function(t,i,e){return e.indexOf(t)===i})}),Array.prototype.method("flatten",function(t){var i=null;if(t){i=this;for(var e=0;t>e;++e)i=Array.prototype.concat.apply([],i)}else i=this.reduce(function(t,i){return Array.isArray(i)?t.concat(i.flatten()):t.concat(i)},[]);return i}),Array.prototype.method("clone",function(t){if(t===!0){for(var i=Array(this.length),e=0,n=this.length;n>e;++e)i[e]=this[e].clone?this[e].clone(t):this[e];return i}return Array.prototype.slice.apply(this)}),Array.prototype.method("clear",function(){return this.length=0,this}),Array.prototype.method("fill",function(t,i,e){i=i||0,e=e||this.length;for(var n=i;e>n;++n)this[n]=t;return this}),Array.prototype.method("range",function(t,i,e){if(this.clear(),1==arguments.length)for(var n=0;t>n;++n)this[n]=n;else if(i>t){e=e||1;for(var n=t,s=0;i>n;n+=e,++s)this[s]=n}else{e=e||-1;for(var n=t,s=0;n>i;n+=e,++s)this[s]=n}return this}),Array.prototype.method("shuffle",function(){for(var t=0,i=this.length;i>t;++t){var e=Math.rand(0,i-1);t!=e&&this.swap(t,e)}return this}),Array.prototype.method("sum",function(){for(var t=0,i=0,e=this.length;e>i;++i)t+=this[i];return t}),Array.prototype.method("average",function(){for(var t=0,i=this.length,e=0;i>e;++e)t+=this[e];return t/i}),Array.prototype.method("each",function(){return this.forEach.apply(this,arguments),this}),Array.prototype.method("toULElement",function(){}),Array.prototype.method("toOLElement",function(){}),Array.method("range",function(t,i,e){return Array.prototype.range.apply([],arguments)}),Array.method("of",function(){return Array.prototype.slice.call(arguments)}),Array.method("from",function(t,i,e){return Object(t).length?Array.prototype.map.call(t,"function"==typeof i?i:function(t){return t},e):[]})}(),function(){Math.DEG_TO_RAD=Math.PI/180,Math.RAD_TO_DEG=180/Math.PI,Math.PHI=(1+Math.sqrt(5))/2,Math.degToRad=function(t){return t*Math.DEG_TO_RAD},Math.radToDeg=function(t){return t*Math.RAD_TO_DEG},Math.method("clamp",function(t,i,e){return i>t?i:t>e?e:t}),Math.method("inside",function(t,i,e){return t>=i&&e>=t}),Math.method("rand",function(t,i){return window.Math.floor(Math.random()*(i-t+1))+t}),Math.method("randf",function(t,i){return window.Math.random()*(i-t)+t})}();var phina=phina||{};!function(){phina.method("isNode",function(){return"undefined"!=typeof module}),phina.method("namespace",function(t){t.call(this)});var t=phina.isNode()?global:window;phina.accessor("global",{get:function(){return t}}),phina.method("isMobile",function(){if(!phina.global.navigator)return!1;var t=phina.global.navigator.userAgent;return t.indexOf("iPhone")>0||t.indexOf("iPad")>0||t.indexOf("Android")>0}),phina.isNode()&&(module.exports=phina),t.phina=phina}(this),phina.namespace(function(){phina.method("createClass",function(t){var i=function(){var t=new i.prototype._creator;return i.prototype.init.apply(t,arguments),t};return t.superClass&&(i.prototype=Object.create(t.superClass.prototype),t.init.owner=i,i.prototype.superInit=function(){var t=this.superInit.caller,i=t.owner,e=i.prototype.superClass,n=e.prototype.init;n.apply(this,arguments)},i.prototype.constructor=i),i.prototype.$extend(t),i.prototype.selfClass=i,t._accessor&&(i.prototype=Object.create(i.prototype,t._accessor)),i.prototype._creator=function(){return this},i.prototype._creator.prototype=i.prototype,t._static&&i.$extend(t._static),i});phina.method("using",function(t){if(!t)return phina.global;var i=t.split(/[,.\/ ]|::/),e=phina.global;return i.forEach(function(t){e=e[t]||(e[t]={})}),e}),phina.method("register",function(t,i){var e=t.split(/[,.\/ ]|::/),n=e.last,s=t.substring(0,t.lastIndexOf(".")),a=phina.using(s);return a[n]=i,i});var t={};phina.method("define",function(i,e){if(e.superClass)if("string"==typeof e.superClass){var n=phina.using(e.superClass);if("function"!=typeof n)return null==t[e.superClass]&&(t[e.superClass]=[]),void t[e.superClass].push(function(){phina.define(i,e)});e.superClass=n}else e.superClass=e.superClass;var s=phina.createClass(e);return s.prototype.accessor("className",{get:function(){return i}}),phina.register(i,s),t[i]&&(t[i].forEach(function(t){t()}),t[i]=null),s}),phina.method("globalize",function(){phina.forIn(function(t,i){i.forIn(function(t,i){phina.global[t]=i})})}),phina._mainListeners=[],phina._mainLoaded=!1,phina.method("main",function(t){phina._mainLoaded?t():phina._mainListeners.push(t)}),phina.global.addEventListener?phina.global.addEventListener("load",function(){phina._mainListeners.each(function(t){t()}),phina._mainListeners.clear(),phina._mainLoaded=!0}):phina._mainLoaded=!0}),phina.namespace(function(){phina.define("phina.geom.Vector2",{init:function(t,i){this.x=t,this.y=i},clone:function(){return phina.geom.Vector2(this.x,this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},set:function(t,i){return this.x=t,this.y=i,this},add:function(t){return this.x+=t.x,this.y+=t.y,this},sub:function(t){return this.x-=t.x,this.y-=t.y,this},mul:function(t){return this.x*=t,this.y*=t,this},div:function(t){return t=t||.01,this.x/=t,this.y/=t,this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthSquared:function(){return this.x*this.x+this.y*this.y},distance:function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},distanceSquared:function(t){return Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)},random:function(t,i){var e=Math.randf(t||0,i||360),n=e*Math.DEG_TO_RAD;return this.x=Math.cos(n),this.y=Math.sin(n),this},normalize:function(){return this.div(this.length())},_accessor:{},_defined:function(){}})}),phina.namespace(function(){phina.define("phina.geom.Matrix33",{init:function(){arguments.length>=9?this.set.apply(this,arguments):this.identity()},set:function(t,i,e,n,s,a,r,h,o){return this.m00=t,this.m01=i,this.m02=e,this.m10=n,this.m11=s,this.m12=a,this.m20=r,this.m21=h,this.m22=o,this},identity:function(){return this.m00=1,this.m01=0,this.m02=0,this.m10=0,this.m11=1,this.m12=0,this.m20=0,this.m21=0,this.m22=1,this},clone:function(){return phina.geom.Matrix33(this.m00,this.m01,this.m02,this.m10,this.m11,this.m12,this.m20,this.m21,this.m22)},determinant:function(){var t=this.m00,i=this.m01,e=this.m02,n=this.m10,s=this.m11,a=this.m12,r=this.m20,h=this.m21,o=this.m22;return t*s*o+n*h*e+i*a*r-e*s*r-i*n*o-a*h*t},transpose:function(){var t=function(t,i){var e=this[t];this[t]=this[i],this[i]=e}.bind(this);return t("m01","m10"),t("m02","m20"),t("m12","m21"),this},invert:function(){var t=this.m00,i=this.m01,e=this.m02,n=this.m10,s=this.m11,a=this.m12,r=this.m20,h=this.m21,o=this.m22,u=this.determinant();return this.m00=(s*o-a*h)/u,this.m01=(n*o-a*r)/u*-1,this.m02=(n*h-s*r)/u,this.m10=(i*o-e*h)/u*-1,this.m11=(t*o-e*r)/u,this.m12=(t*h-i*r)/u*-1,this.m20=(i*a-e*s)/u,this.m21=(t*a-e*n)/u*-1,this.m22=(t*s-i*n)/u,this.transpose(),this},multiply:function(t){var i=(this.m,t.m,this.m00),e=this.m01,n=this.m02,s=this.m10,a=this.m11,r=this.m12,h=this.m20,o=this.m21,u=this.m22,c=t.m00,p=t.m01,l=t.m02,d=t.m10,f=t.m11,g=t.m12,m=t.m20,y=t.m21,v=t.m22;return this.m00=i*c+e*d+n*m,this.m01=i*p+e*f+n*y,this.m02=i*l+e*g+n*v,this.m10=s*c+a*d+r*m,this.m11=s*p+a*f+r*y,this.m12=s*l+a*g+r*v,this.m20=h*c+o*d+u*m,this.m21=h*p+o*f+u*y,this.m22=h*l+o*g+u*v,this},multiplyVector2:function(t){var i=this.m00*t.x+this.m01*t.y+this.m02,e=this.m10*t.x+this.m11*t.y+this.m12;return phina.geom.Vector2(i,e)},getRow:function(){},getCol:function(){},toString:function(){return"|{m00}, {m01}, {m02}|\n|{m10}, {m11}, {m12}|\n|{m20}, {m21}, {m22}|".format(this)},_accessor:{x:{get:function(){return this._x},set:function(t){this._x=t}}}}),phina.geom.Matrix33.IDENTITY=phina.geom.Matrix33().identity()}),phina.namespace(function(){phina.define("phina.geom.Rect",{x:0,y:0,width:32,height:32,init:function(t,i,e,n){this.set(t,i,e,n)},set:function(t,i,e,n){return this.x=t,this.y=i,this.width=e,this.height=n,this},moveTo:function(t,i){return this.x=t,this.y=i,this},moveBy:function(t,i){return this.x+=t,this.y+=i,this},setSize:function(t,i){return this.width=t,this.height=i,this},padding:function(t,i,e,n){switch(arguments.length){case 1:t=i=e=n=arguments[0];break;case 2:t=e=arguments[0],i=n=arguments[1];break;case 3:t=arguments[0],i=n=arguments[1],e=arguments[2]}return this.x+=n,this.y+=t,this.width-=n+i,this.height-=t+e,this},contains:function(t,i){return this.left<=t&&t<=this.right&&this.top<=i&&i<=this.bottom},clone:function(){return phina.geom.Rect(this.x,this.y,this.width,this.height)},toCircle:function(){var t=(this.width<this.height?this.width:this.height)/2;return phina.geom.Circle(this.centerX,this.centerY,t)},toArray:function(){return[this.x,this.y,this.width,this.height]},_accessor:{left:{get:function(){return this.x},set:function(t){this.width-=t-this.x,this.x=t}},top:{get:function(){return this.y},set:function(t){this.height-=t-this.y,this.y=t}},right:{get:function(){return this.x+this.width},set:function(t){this.width+=t-this.right}},bottom:{get:function(){return this.y+this.height},set:function(t){this.height+=t-this.bottom}},centerX:{get:function(){return this.x+this.width/2},set:function(t){}},centerY:{get:function(){return this.y+this.height/2},set:function(t){}}}})}),phina.namespace(function(){phina.define("phina.geom.Circle",{x:0,y:0,radius:32,init:function(t,i,e){this.set(t,i,e)},set:function(t,i,e){return this.x=t,this.y=i,this.radius=e,this},moveTo:function(t,i){return this.x=t,this.y=i,this},moveBy:function(t,i){return this.x+=t,this.y+=i,this},contains:function(t,i){var e=this.x-t,n=this.y-i,s=e*e+n*n;return s<=this.radius*this.radius},clone:function(){return phina.geom.Circle(this.x,this.y,this.radius)},toRect:function(){var t=this.size;return phina.geom.Rect(this.x-this.radius,this.y-this.radius,t,t)},toArray:function(){return[this.x,this.y,this.radius]},_accessor:{left:{get:function(){return this.x-this.radius},set:function(t){}},top:{get:function(){return this.y-this.radius},set:function(t){}},right:{get:function(){return this.x+this.radius},set:function(t){}},bottom:{get:function(){return this.y+this.radius},set:function(t){}},size:{get:function(){return 2*this.radius},set:function(t){}}}})}),phina.namespace(function(){phina.define("phina.util.EventDispatcher",{init:function(){this._listeners={}},on:function(t,i){return void 0===this._listeners[t]&&(this._listeners[t]=[]),this._listeners[t].push(i),this},off:function(t,i){var e=this._listeners[t],n=e.indexOf(i);return-1!=n&&e.splice(n,1),this},fire:function(t){t.target=this;var i="on"+t.type;this[i]&&this[i](t);var e=this._listeners[t.type];if(e)for(var n=e.clone(),s=0,a=n.length;a>s;++s)n[s].call(this,t);return this},flare:function(t,i){var e={type:t};return i&&i.forIn(function(t,i){e[t]=i}),this.fire(e),this},one:function(t,i){var e=this,n=function(){var s=i.apply(e,arguments);return e.off(t,n),s};return this.on(t,n),this},has:function(t){return void 0!==this._listeners[t]||this["on"+t]?!0:!1},clear:function(t){var i="on"+t;return this[i]&&delete this[i],this._listeners[t]=[],this}})}),function(){phina.define("phina.util.Tween",{superClass:"phina.util.EventDispatcher",init:function(t){this.superInit(),this.time=0},fromTo:function(t,i,e,n,s){this.target=t,this.beginProps=i,this.finishProps=e,this.duration=n||1e3,this.easing=s,this.changeProps={};for(var a in i)this.changeProps[a]=e[a]-i[a];return this},to:function(t,i,e,n){var s={};for(var a in i)s[a]=t[a];return this.fromTo(t,s,i,e,n),this},from:function(t,i,e,n){var s={};for(var a in i)s[a]=t[a],t[a]=i[a];return this.fromTo(t,i,s,e,n),this},by:function(t,i,e,n){var s={},a={};for(var r in i)s[r]=t[r],a[r]=t[r]+i[r];return this.fromTo(t,s,a,e,n),this},yoyo:function(){var t=this.beginProps;return this.beginProps=this.finishProps,this.finishProps=t,this.changeProps.forIn(function(t,i,e){this.changeProps[t]=-i,this.target[t]=this.beginProps[t]},this),this},gain:function(t){this.seek(this.time+t)},forward:function(t){this.seek(this.time+t)},backward:function(t){this.seek(this.time-t)},seek:function(t){return this.time=Math.clamp(t,0,this.duration),this.beginProps.forIn(function(t,i){var e=this.easing(this.time,i,this.changeProps[t],this.duration);this.target[t]=e},this),this},_accessor:{easing:{get:function(){return this._easing},set:function(t){this._easing=phina.util.Tween.EASING[t]||phina.util.Tween.EASING["default"]}}}}),phina.util.Tween.EASING={"default":function(t,i,e,n){return e*t/n+i},linear:function(t,i,e,n){return e*t/n+i},swing:function(t,i,e,n){return-e*(t/=n)*(t-2)+i},easeInQuad:function(t,i,e,n){return e*(t/=n)*t+i},easeOutQuad:function(t,i,e,n){return-e*(t/=n)*(t-2)+i},easeInOutQuad:function(t,i,e,n){return(t/=n/2)<1?e/2*t*t+i:-e/2*(--t*(t-2)-1)+i},easeInCubic:function(t,i,e,n){return e*(t/=n)*t*t+i},easeOutCubic:function(t,i,e,n){return e*((t=t/n-1)*t*t+1)+i},easeInOutCubic:function(t,i,e,n){return(t/=n/2)<1?e/2*t*t*t+i:e/2*((t-=2)*t*t+2)+i},easeOutInCubic:function(t,i,e,n){return n/2>t?tm.anim.easing.easeOutCubic(2*t,i,e/2,n):tm.anim.easing.easeInCubic(2*t-n,i+e/2,e/2,n)},easeInQuart:function(t,i,e,n){return e*(t/=n)*t*t*t+i},easeOutQuart:function(t,i,e,n){return-e*((t=t/n-1)*t*t*t-1)+i},easeInOutQuart:function(t,i,e,n){return(t/=n/2)<1?e/2*t*t*t*t+i:-e/2*((t-=2)*t*t*t-2)+i},easeOutInQuart:function(t,i,e,n){return n/2>t?tm.anim.easing.easeOutQuart(2*t,i,e/2,n):tm.anim.easing.easeInQuart(2*t-n,i+e/2,e/2,n)},easeInQuint:function(t,i,e,n){return e*(t/=n)*t*t*t*t+i},easeOutQuint:function(t,i,e,n){return e*((t=t/n-1)*t*t*t*t+1)+i},easeInOutQuint:function(t,i,e,n){return(t/=n/2)<1?e/2*t*t*t*t*t+i:e/2*((t-=2)*t*t*t*t+2)+i},easeOutInQuint:function(t,i,e,n){return n/2>t?tm.anim.easing.easeOutQuint(2*t,i,e/2,n):tm.anim.easing.easeInQuint(2*t-n,i+e/2,e/2,n)},easeInSine:function(t,i,e,n){return-e*Math.cos(t/n*(Math.PI/2))+e+i},easeOutSine:function(t,i,e,n){return e*Math.sin(t/n*(Math.PI/2))+i},easeInOutSine:function(t,i,e,n){return-e/2*(Math.cos(Math.PI*t/n)-1)+i},easeOutInSine:function(t,i,e,n){return n/2>t?tm.anim.easing.easeOutSine(2*t,i,e/2,n):tm.anim.easing.easeInSine(2*t-n,i+e/2,e/2,n)},easeInExpo:function(t,i,e,n){return 0==t?i:e*Math.pow(2,10*(t/n-1))+i-.001*e},easeOutExpo:function(t,i,e,n){return t==n?i+e:1.001*e*(-Math.pow(2,-10*t/n)+1)+i},easeInOutExpo:function(t,i,e,n){return 0==t?i:t==n?i+e:(t/=n/2)<1?e/2*Math.pow(2,10*(t-1))+i-5e-4*e:e/2*1.0005*(-Math.pow(2,-10*--t)+2)+i},easeOutInExpo:function(t,i,e,n){return n/2>t?tm.anim.easing.easeOutExpo(2*t,i,e/2,n):tm.anim.easing.easeInExpo(2*t-n,i+e/2,e/2,n)},easeInCirc:function(t,i,e,n){return-e*(Math.sqrt(1-(t/=n)*t)-1)+i},easeOutCirc:function(t,i,e,n){return e*Math.sqrt(1-(t=t/n-1)*t)+i},easeInOutCirc:function(t,i,e,n){return(t/=n/2)<1?-e/2*(Math.sqrt(1-t*t)-1)+i:e/2*(Math.sqrt(1-(t-=2)*t)+1)+i},easeOutInCirc:function(t,i,e,n){return n/2>t?tm.anim.easing.easeOutCirc(2*t,i,e/2,n):tm.anim.easing.easeInCirc(2*t-n,i+e/2,e/2,n)},easeInElastic:function(t,i,e,n,s,a){var r;return 0==t?i:1==(t/=n)?i+e:(a||(a=.3*n),!s||s<Math.abs(e)?(s=e,r=a/4):r=a/(2*Math.PI)*Math.asin(e/s),-(s*Math.pow(2,10*(t-=1))*Math.sin((t*n-r)*(2*Math.PI)/a))+i)},easeOutElastic:function(t,i,e,n,s,a){var r;return 0==t?i:1==(t/=n)?i+e:(a||(a=.3*n),!s||s<Math.abs(e)?(s=e,r=a/4):r=a/(2*Math.PI)*Math.asin(e/s),s*Math.pow(2,-10*t)*Math.sin((t*n-r)*(2*Math.PI)/a)+e+i)},easeInOutElastic:function(t,i,e,n,s,a){var r;return 0==t?i:2==(t/=n/2)?i+e:(a||(a=n*(.3*1.5)),!s||s<Math.abs(e)?(s=e,r=a/4):r=a/(2*Math.PI)*Math.asin(e/s),1>t?-.5*(s*Math.pow(2,10*(t-=1))*Math.sin((t*n-r)*(2*Math.PI)/a))+i:s*Math.pow(2,-10*(t-=1))*Math.sin((t*n-r)*(2*Math.PI)/a)*.5+e+i)},easeOutInElastic:function(t,i,e,n,s,a){return n/2>t?tm.anim.easing.easeOutElastic(2*t,i,e/2,n,s,a):tm.anim.easing.easeInElastic(2*t-n,i+e/2,e/2,n,s,a)},easeInBack:function(t,i,e,n,s){return void 0==s&&(s=1.70158),e*(t/=n)*t*((s+1)*t-s)+i},easeOutBack:function(t,i,e,n,s){return void 0==s&&(s=1.70158),e*((t=t/n-1)*t*((s+1)*t+s)+1)+i},easeInOutBack:function(t,i,e,n,s){return void 0==s&&(s=1.70158),(t/=n/2)<1?e/2*(t*t*(((s*=1.525)+1)*t-s))+i:e/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+i},easeOutInBack:function(t,i,e,n,s){return n/2>t?tm.anim.easing.easeOutBack(2*t,i,e/2,n,s):tm.anim.easing.easeInBack(2*t-n,i+e/2,e/2,n,s)},easeInBounce:function(t,i,e,n){return e-tm.anim.easing.easeOutBounce(n-t,0,e,n)+i},easeOutBounce:function(t,i,e,n){return(t/=n)<1/2.75?e*(7.5625*t*t)+i:2/2.75>t?e*(7.5625*(t-=1.5/2.75)*t+.75)+i:2.5/2.75>t?e*(7.5625*(t-=2.25/2.75)*t+.9375)+i:e*(7.5625*(t-=2.625/2.75)*t+.984375)+i},easeInOutBounce:function(t,i,e,n){return n/2>t?.5*tm.anim.easing.easeInBounce(2*t,0,e,n)+i:.5*tm.anim.easing.easeOutBounce(2*t-n,0,e,n)+.5*e+i},easeOutInBounce:function(t,i,e,n){return n/2>t?tm.anim.easing.easeOutBounce(2*t,i,e/2,n):tm.anim.easing.easeInBounce(2*t-n,i+e/2,e/2,n)}}}(),function(){phina.define("phina.util.Ticker",{superClass:"phina.util.EventDispatcher",frame:null,deltaTime:null,elapsedTime:null,init:function(){this.superInit(),this.fps=30,this.frame=0,this.deltaTime=0,this.elapsedTime=0},tick:function(t){this.on("tick",t)},run:function(){var t=(new Date).getTime();this.deltaTime=t-this.currentTime,this.elapsedTime=t-this.startTime;var i=this.currentTime=t;this.flare("tick");var e=(new Date).getTime();this.frame+=1;var n=e-i,s=Math.max(this.frameTime-n,0);return s},start:function(){var t=this;return this.startTime=this.currentTime=(new Date).getTime(),function(){var i=t.run();setTimeout(arguments.callee,i)}(),this},resume:function(){},stop:function(){},rewind:function(){},_accessor:{fps:{get:function(){return this._fps},set:function(t){this._fps=t,this.frameTime=1e3/this._fps}}}})}(),function(){phina.define("phina.util.Grid",{width:640,columns:12,loop:!1,init:function(){if("object"==typeof arguments[0])var t=arguments[0],i=t.width||640,e=t.columns||12,n=t.loop||!1;else var i=arguments[0]||640,e=arguments[1]||12,n=arguments[2]||!1;this.width=i,this.columns=e,this.loop=n,this.unitWidth=this.width/this.columns},span:function(t){return this.loop&&(t+=this.columns,t%=this.columns),this.unitWidth*t},unit:function(){return this.unitWidth},center:function(){return this.width/2}})}(),phina.namespace(function(){phina.define("phina.util.ChangeDispatcher",{superClass:"phina.util.EventDispatcher",init:function(){this.superInit(),this._observe=!0},register:function(t,i){if(1===arguments.length){var e=arguments[0];e.forIn(function(t,i){this.register(t,i)},this)}else{var n="__"+t;this[n]=i,this.accessor(t,{get:function(){return this[n]},set:function(t){this[n]=t,this._observe&&this.flare("change")}})}return this},observe:function(){this._observe=!0},unobserve:function(){this._observe=!1}})}),function(){phina.define("phina.util.Flow",{superClass:"phina.util.EventDispatcher",init:function(t,i){if(this.superInit(),this.status="pending",this.resultValue=null,this._queue=[],this.func=t,i!==!0){var e=this,n=function(){e.resolve.apply(e,arguments),e.status="resolved"},s=function(){e.reject.apply(e,arguments),e.status="rejected"};this.func(n,s)}},resolve:function(t){this.resultValue=t,this._queue.each(function(t){t(this.resultValue)},this),this._queue.clear()},reject:function(){},then:function(t){if("resolved"===this.status){var i=t(this.resultValue);return phina.util.Flow.resolve(i)}var e=phina.util.Flow(function(t){t()},!0);return this._queue.push(function(i){var n=t(i);n instanceof phina.util.Flow?n.then(function(t){e.resolve(t)}):e.resolve(i)}),e},_static:{resolve:function(t){if(t instanceof phina.util.Flow)return t;var i=phina.util.Flow(function(i){i(t)});return i},all:function(t){return phina.util.Flow(function(i){var e=0,n=[];t.each(function(s){s.then(function(s){++e,n.push(s),e>=t.length&&i(n)})})})}}})}(),phina.namespace(function(){phina.define("phina.util.Color",{r:255,g:255,b:255,a:1,init:function(t,i,e,n){this.set.apply(this,arguments)},set:function(t,i,e,n){return this.r=t,this.g=i,this.b=e,this.a=void 0!==n?n:1,this},setFromNumber:function(t,i,e,n){return this.r=t,this.g=i,this.b=e,this.a=void 0!==n?n:1,this},setFromArray:function(t){return this.set.apply(this,t)},setFromObject:function(t){return this.set(t.r,t.g,t.b,t.a)},setFromString:function(t){var i=phina.util.Color.stringToNumber(t);return this.set(i[0],i[1],i[2],i[3])},setSmart:function(){var t=arguments[0];return arguments.length>=3?this.set(arguments.r,arguments.g,arguments.b,arguments.a):t instanceof Array?this.setFromArray(t):t instanceof Object?this.setFromObject(t):"string"==typeof t&&this.setFromString(t),this},toStyleAsHex:function(){return"#{0}{1}{2}".format(this.r.toString(16).padding(2,"0"),this.g.toString(16).padding(2,"0"),this.b.toString(16).padding(2,"0"))},toStyleAsRGB:function(){return"rgb({r},{g},{b})".format({r:~~this.r,g:~~this.g,b:~~this.b})},toStyleAsRGBA:function(){return"rgba({r},{g},{b},{a})".format({r:~~this.r,g:~~this.g,b:~~this.b,a:this.a})},toStyle:function(){return"rgba({r},{g},{b},{a})".format({r:~~this.r,g:~~this.g,b:~~this.b,a:this.a})},_static:{COLOR_LIST:{black:[0,0,0],silver:[192,192,192],gray:[128,128,128],white:[255,255,255],maroon:[128,0,0],red:[255,0,0],purple:[128,0,128],fuchsia:[255,0,255],green:[0,128,0],lime:[0,255,0],olive:[128,128,0],yellow:[255,255,0],navy:[0,0,128],blue:[0,0,255],teal:[0,128,128],aqua:[0,255,255]},strToNum:function(t){return this.stringToNumber(t)},stringToNumber:function(i){var e=null;if("#"===i[0]?e=4==i.length?"hex111":"hex222":"r"===i[0]&&"g"===i[1]&&"b"===i[2]?e="a"==i[3]?"rgba":"rgb":"h"===i[0]&&"s"===i[1]&&"l"===i[2]&&(e="a"==i[3]?"hsla":"hsl"),e){var n=t[e],s=i.match(n.reg);value=n.exec(s)}else phina.util.Color.COLOR_LIST[i]&&(value=phina.util.Color.COLOR_LIST[i]);return value},HSLtoRGB:function(t,i,e){var n,s,a;if(t%=360,t+=360,t%=360,i*=.01,e*=.01,0==i){var e=Math.round(255*e);return[e,e,e]}var r=.5>e?e*(1+i):e+i-e*i,h=2*e-r,o=(t+120)%360;return n=60>o?h+(r-h)*o/60:180>o?r:h,o=t,s=60>o?h+(r-h)*o/60:180>o?r:240>o?h+(r-h)*(240-o)/60:h,o=(t-120+360)%360,a=60>o?h+(r-h)*o/60:180>o?r:240>o?h+(r-h)*(240-o)/60:h,[parseInt(255*n),parseInt(255*s),parseInt(255*a)]},HSLAtoRGBA:function(t,i,e,n){var s=phina.util.Color.HSLtoRGB(t,i,e);return s[3]=n,rgb},createStyleRGB:function(t,i,e){return"rgba("+t+","+i+","+e+")"},createStyleRGBA:function(t,i,e,n){return"rgba("+t+","+i+","+e+","+n+")"},createStyleHSL:function(t,i,e){return"hsl("+t+","+i+"%,"+e+"%)"},createStyleHSLA:function(t,i,e,n){return"hsla("+t+","+i+"%,"+e+"%,"+n+")"}}});var t={hex111:{reg:/^#(\w{1})(\w{1})(\w{1})$/,exec:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}},hex222:{reg:/^#(\w{2})(\w{2})(\w{2})$/,exec:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},rgb:{reg:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,exec:function(t){return[parseInt(t[1]),parseInt(t[2]),parseInt(t[3])]}},rgba:{reg:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*(\d{1}(\.{1}\d+)?)\)$/,exec:function(t){return[parseInt(t[1]),parseInt(t[2]),parseInt(t[3]),parseFloat(t[4])]}},hsl:{reg:/^hsl\((\d{1,3}),\s*(\d{1,3})%,\s*(\d{1,3})%\)$/,exec:function(t){return phina.util.Color.HSLtoRGB(t[1],t[2],t[3])}},hsla:{reg:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*(\d{1}(\.{1}\d+)?)\)$/,exec:function(t){return phina.util.Color.HSLAtoRGBA(t[1],t[2],t[3],t[4])}}}}),phina.namespace(function(){phina.define("phina.asset.Asset",{superClass:"phina.util.EventDispatcher",init:function(t){this.superInit(),this.loaded=!1},load:function(t){return this.src=t,phina.util.Flow(this._load.bind(this))},isLoaded:function(){return this.loaded},_load:function(t){var i=this;setTimeout(function(){
i.loaded=!0,t()},100)}})}),phina.namespace(function(){phina.define("phina.asset.AssetManager",{_static:{assets:{image:{},sound:{},spritesheet:{}},get:function(t,i){return this.assets[t]&&this.assets[t][i]},set:function(t,i,e){this.assets[t]||(this.assets[t]={}),this.assets[t][i]=e},contains:function(t,i){}}})}),phina.namespace(function(){phina.define("phina.asset.AssetLoader",{superClass:"phina.util.EventDispatcher",init:function(t){this.superInit(),t=(t||{}).$safe({cache:!0}),this.assets={},this.cache=t.cache},load:function(t){var i=this,e=[],n=0;return t.forIn(function(t,s){s.forIn(function(s,a){var r=phina.asset.AssetLoader.assetLoadFunctions[t],h=r(s,a);h.then(function(a){i.flare("progress",{key:s,asset:a,progress:++n/e.length}),i.cache&&phina.asset.AssetManager.set(t,s,a)}),e.push(h)})}),phina.util.Flow.all(e).then(function(t){i.flare("load")})},_static:{assetLoadFunctions:{image:function(t,i){var e=phina.asset.Texture(),n=e.load(i);return n},sound:function(t,i){var e=phina.asset.Sound(),n=e.load(i);return n},spritesheet:function(t,i){var e=phina.asset.SpriteSheet(),n=e.load(i);return n},script:function(t,i){var e=phina.asset.Script();return e.load(i)},font:function(t,i){var e=phina.asset.Font();return e.setFontName(t),e.load(i)}}}})}),phina.namespace(function(){phina.define("phina.asset.File",{superClass:"phina.asset.Asset",init:function(){this.superInit()},_load:function(t){var i={};"string"==typeof this.src?i.$extend({path:this.src}):"object"==typeof this.src&&i.$extend(this.src),i.$safe({path:"",dataType:"text"});var e=this,n=new XMLHttpRequest;n.open("GET",i.path),n.onreadystatechange=function(){if(4===n.readyState&&-1!==[200,201,0].indexOf(n.status)){var s=n.responseText;"json"===i.dataType&&(s=JSON.parse(s)),e.data=s,t(e)}},n.send(null)}})}),phina.namespace(function(){phina.define("phina.asset.Script",{superClass:"phina.asset.Asset",init:function(){this.superInit()},_load:function(t){this.domElement=document.createElement("script"),this.domElement.src=this.src,this.domElement.onload=function(){t(self)}.bind(this),document.body.appendChild(this.domElement)}})}),phina.namespace(function(){phina.define("phina.asset.Texture",{superClass:"phina.asset.Asset",init:function(){this.superInit()},_load:function(t){this.domElement=new Image,this.domElement.src=this.src;var i=this;this.domElement.onload=function(e){i.loaded=!0,t(i)},this.domElement.onerror=function(t){console.error("[phina.js] not found `{0}`!".format(this.src));var e=i.src.split("/").last.replace(".png","").split("?").first.split("#").first;t.target.src="http://dummyimage.com/128x128/444444/eeeeee&text="+e,t.target.onerror=null}}})}),phina.namespace(function(){phina.define("phina.asset.Sound",{superClass:"phina.asset.Asset",init:function(){this.superInit(),this.context=phina.asset.Sound.audioContext},clone:function(){var t=phina.asset.Sound();return t.loadFromBuffer(this.source.buffer),t.volume=this.volume,t},play:function(){if(this.source.start(0),this.source.buffer){var t=this.source.buffer.duration/this.source.playbackRate.value*1e3;window.setTimeout(function(t){t.flare("ended")},t,this)}return this},_oscillator:function(t){var i=this.context,e=i.createOscillator();e.type=t||"sine",this.source=e,this.source.connect(i.destination)},loadFromBuffer:function(t){var i=this.context;if(!t){t=i.createBuffer(1,44100,44100);for(var e=t.getChannelData(0),n=0;n<e.length;n++)e[n]=Math.sin(n/100*Math.PI)}var s=i.createBufferSource();s.buffer=t,this.source=s,this.source.connect(i.destination)},_load:function(t){var i=this,e=new XMLHttpRequest;e.open("GET",this.src),e.onreadystatechange=function(){if(4===e.readyState&&-1!==[200,201,0].indexOf(e.status)){var n=e.response;i.context.decodeAudioData(n,function(e){i.loadFromBuffer(e),t(i)},function(){console.warn("音声ファイルのデコードに失敗しました。("+src+")"),i.loaded=!0,t(i)})}},e.responseType="arraybuffer",e.send(null)},_static:{audioContext:function(){if(phina.isNode())return null;var t=phina.global,i=null;return t.AudioContext?i=new AudioContext:t.webkitAudioContext?i=new webkitAudioContext:t.mozAudioContext&&(i=new mozAudioContext),i}()}})}),phina.namespace(function(){phina.define("phina.asset.SpriteSheet",{superClass:"phina.asset.Asset",init:function(){this.superInit()},setup:function(t){return this._setupFrame(t.frame),this._setupAnim(t.animations),this},_load:function(t){var i=this;if("string"==typeof this.src){var e=new XMLHttpRequest;e.open("GET",this.src),e.onreadystatechange=function(){if(4===e.readyState&&-1!==[200,201,0].indexOf(e.status)){var n=e.responseText,s=JSON.parse(n);i.setup(s),t(i)}},e.send(null)}else this.setup(this.src),t(i)},_setupFrame:function(t){var i=this.frames=[],e=t.width,n=t.height,s=t.rows*t.cols;this.frame=s,s.times(function(s){var a=s%t.cols,r=s/t.cols|0;i.push({x:a*e,y:r*n,width:e,height:n})})},_setupAnim:function(t){this.animations={},this.animations["default"]={frames:[].range(0,this.frame),next:"default",frequency:1},t.forIn(function(t,i){var e=i;e instanceof Array?this.animations[t]={frames:[].range(e[0],e[1]),next:e[2],frequency:e[3]||1}:this.animations[t]={frames:e.frames,next:e.next,frequency:e.frequency||1}},this)},getFrame:function(t){return this.frames[t]},getAnimation:function(t){return t=void 0!==t?t:"default",this.animations[t]}})}),phina.namespace(function(){phina.define("phina.asset.Font",{superClass:"phina.asset.Asset",init:function(){this.superInit(),this.fontName=null},load:function(t){this.src=t;var i=/(.*)(?:\.([^.]+$))/,e=this.fontName||t.match(i)[1].split("/").last,n=t.match(i)[2],s="unknown";switch(n){case"ttf":s="truetype";break;case"otf":s="opentype";break;case"woff":s="woff";break;case"woff2":s="woff2";break;default:console.warn("サポートしていないフォント形式です。("+t+")")}if(this.format=s,this.fontName=e,"unknown"!==s){var a="@font-face { font-family: '{0}'; src: url({1}) format('{2}'); }".format(e,t,s),r=document.querySelector("head"),h=document.createElement("style");h.innerText?h.innerText=a:h.textContent=a,r.appendChild(h)}return phina.util.Flow(this._load.bind(this))},_load:function(t){"unknown"!==this.format?this._checkLoaded(this.fontName,function(){this.loaded=!0,t(this)}.bind(this)):(this.loaded=!0,t(this))},_checkLoaded:function(t,i){var e=phina.graphics.Canvas(),n=e.context.font.split(" ")[1];e.context.font="40px "+n;var s="1234567890-^\\qwertyuiop@[asdfghjkl;:]zxcvbnm,./!\"#$%&'()=~|QWERTYUIOP`{ASDFGHJKL+*}ZXCVBNM<>?_１２３４５６７８９０－＾￥ｑｗｅｒｔｙｕｉｏｐａｓｄｆｇｈｊｋｌｚｘｃｖｂｎｍ，．あいうかさたなをん時は金なり";s+=String.fromCharCode("0xf04b");var a=e.context.measureText(s).width;e.context.font="40px "+t+", "+n;var r=30,h=function(){var t=e.context.measureText(s).width;t!==a?setTimeout(function(){i&&i()},100):--r>0?setTimeout(h,100):(i&&i(),console.warn("timeout font loading"))};h()},setFontName:function(t){return this.loaded?(console.warn("フォント名はLoad前にのみ設定が出来ます("+t+")"),this):(this.fontName=t,this)},getFontName:function(){return this.fontName}})}),function(){phina.define("phina.input.Input",{domElement:null,init:function(t){this.domElement=t||window.document,this.position=phina.geom.Vector2(0,0),this.deltaPosition=phina.geom.Vector2(0,0),this.prevPosition=phina.geom.Vector2(0,0),this._tempPosition=phina.geom.Vector2(0,0),this.flags=0},update:function(){this.last=this.now,this.now=this.flags,this.start=(this.now^this.last)&this.now,this.end=(this.now^this.last)&this.last,this.deltaPosition.x=this._tempPosition.x-this.position.x,this.deltaPosition.y=this._tempPosition.y-this.position.y,0===this.deltaPosition.x&&0===this.deltaPosition.y?this._moveFlag=!1:this._moveFlag=!0,this.prevPosition.set(this.position.x,this.position.y),this.position.set(this._tempPosition.x,this._tempPosition.y)},_start:function(t,i,e){e=void 0!==e?e:1,this._move(t,i),this.flags|=e;var t=this._tempPosition.x,i=this._tempPosition.y;this.position.set(t,i),this.prevPosition.set(t,i)},_end:function(t){t=void 0!==t?t:1,this.flags&=~t},_move:function(t,i){this._tempPosition.x=t,this._tempPosition.y=i;var e=this.domElement;e.style.width&&(this._tempPosition.x*=e.width/parseInt(e.style.width)),e.style.height&&(this._tempPosition.y*=e.height/parseInt(e.style.height))},_accessor:{x:{get:function(){return this.position.x},set:function(t){this.position.x=t}},y:{get:function(){return this.position.y},set:function(t){this.position.y=t}},dx:{get:function(){return this.deltaPosition.x},set:function(t){this.deltaPosition.x=t}},dy:{get:function(){return this.deltaPosition.y},set:function(t){this.deltaPosition.y=t}}}})}(),function(){phina.define("phina.input.Mouse",{superClass:"phina.input.Input",init:function(t){this.superInit(t),this.id=0;var i=this;this.domElement.addEventListener("mousedown",function(t){i._start(t.pointX,t.pointY,1<<t.flags)}),this.domElement.addEventListener("mouseup",function(t){i._end(1<<t.flags)}),this.domElement.addEventListener("mousemove",function(t){i._move(t.pointX,t.pointY)})},getButton:function(i){return"string"==typeof i&&(i=t[i]),0!=(this.now&i)},getButtonDown:function(i){return"string"==typeof i&&(i=t[i]),0!=(this.start&i)},getButtonUp:function(i){return"string"==typeof i&&(i=t[i]),0!=(this.end&i)},_static:{BUTTON_LEFT:1,BUTTON_MIDDLE:2,BUTTON_RIGHT:4}});var t={left:phina.input.Mouse.BUTTON_LEFT,middle:phina.input.Mouse.BUTTON_MIDDLE,right:phina.input.Mouse.BUTTON_RIGHT};phina.input.Mouse.prototype.getPointing=function(){return this.getButton("left")},phina.input.Mouse.prototype.getPointingStart=function(){return this.getButtonDown("left")},phina.input.Mouse.prototype.getPointingEnd=function(){return this.getButtonUp("left")}}(),function(){phina.define("phina.input.Touch",{superClass:"phina.input.Input",init:function(t,i){if(this.superInit(t),this.id=null,i!==!0){var e=this;this.domElement.addEventListener("touchstart",function(t){e._start(t.pointX,t.pointY,!0)}),this.domElement.addEventListener("touchend",function(t){e._end()}),this.domElement.addEventListener("touchmove",function(t){e._move(t.pointX,t.pointY)})}},getTouch:function(){return 0!=this.touched},getTouchStart:function(){return 0!=this.start},getTouchEnd:function(){return 0!=this.end}}),phina.input.Touch.prototype.getPointing=phina.input.Touch.prototype.getTouch,phina.input.Touch.prototype.getPointingStart=phina.input.Touch.prototype.getTouchStart,phina.input.Touch.prototype.getPointingEnd=phina.input.Touch.prototype.getTouchEnd}(),function(){phina.define("phina.input.TouchList",{domElement:null,init:function(t,i){this.domElement=t,this.touches=[],this.stockes=[],i.times(function(){var i=phina.input.Touch(t,!0);i.id=null,this.stockes.push(i)},this);var e=this;this.domElement.addEventListener("touchstart",function(t){Array.prototype.forEach.call(t.changedTouches,function(t){var i=e.getEmpty();i.id=t.identifier,i._start(t.pointX,t.pointY)})}),this.domElement.addEventListener("touchend",function(t){Array.prototype.forEach.call(t.changedTouches,function(t){var i=e.getTouch(t.identifier);i._end()})}),this.domElement.addEventListener("touchmove",function(t){Array.prototype.forEach.call(t.changedTouches,function(t){var i=e.getTouch(t.identifier);i._move(t.pointX,t.pointY)}),t.stop()})},getEmpty:function(){var t=this.stockes.pop();return this.touches.push(t),t},getTouch:function(t){return this.touches.filter(function(i){return i.id===t})[0]},removeTouch:function(t){var i=this.touches.indexOf(t);this.touches.splice(i,1),this.stockes.push(t)},update:function(){this.touches.forEach(function(t){null!==t.id&&(t.released?(t.released=!1,this.removeTouch(t)):(t.update(),0===t.flags&&(t.released=!0)))},this)}})}(),phina.namespace(function(){phina.define("phina.input.GamepadManager",{superClass:"phina.util.EventDispatcher",gamepads:null,_created:null,_rawgamepads:null,init:function(){this.superInit(),this.gamepads={},this._created=[],this._rawgamepads=[],this._prevTimestamps={},this._getGamepads=null;var t=phina.global.navigator;t&&t.getGamepads?this._getGamepads=t.getGamepads.bind(t):t&&t.webkitGetGamepads?this._getGamepads=t.webkitGetGamepads.bind(t):this._getGamepads=function(){},phina.global.addEventListener("gamepadconnected",function(t){var i=this.get(t.gamepad.index);i.connected=!0,this.flare("connected",{gamepad:i})}.bind(this)),phina.global.addEventListener("gamepaddisconnected",function(t){var i=this.get(t.gamepad.index);i.connected=!1,this.flare("disconnected",{gamepad:i})}.bind(this))},update:function(){this._poll();for(var t=0,i=this._created.length;i>t;t++){var e=this._created[t],n=this._rawgamepads[e];n&&(n.timestamp&&n.timestamp===this._prevTimestamps[t]?this.gamepads[e]._updateStateEmpty():(this._prevTimestamps[t]=n.timestamp,this.gamepads[e]._updateState(n)))}},get:function(t){return t=t||0,this.gamepads[t]||(this._created.push(t),this.gamepads[t]=phina.input.Gamepad(t)),this.gamepads[t]},dispose:function(t){if(this._created.contains(t)){var i=this.get(t);delete this.gamepad[i],this._created.erase(t),i.connected=!1}},isConnected:function(t){return t=t||0,this._rawgamepads[t]&&this._rawgamepads[t].connected},_poll:function(){var t=this._getGamepads();if(t){this._rawgamepads.clear();for(var i=0,e=t.length;e>i;i++)t[i]&&this._rawgamepads.push(t[i])}},_static:{isAvailable:!!navigator.getGamepads||!!navigator.webkitGetGamepads}}),phina.define("phina.input.Gamepad",{index:null,buttons:null,sticks:null,id:null,connected:!1,mapping:null,timestamp:null,init:function(t){this.index=t||0,this.buttons=Array.range(0,16).map(function(){return{value:0,pressed:!1,last:!1,down:!1,up:!1}}),this.sticks=Array.range(0,2).map(function(){return phina.geom.Vector2(0,0)})},getKey:function(t){return"string"==typeof t&&(t=phina.input.Gamepad.BUTTON_CODE[t]),this.buttons[t]?this.buttons[t].pressed:!1},getKeyDown:function(t){return"string"==typeof t&&(t=phina.input.Gamepad.BUTTON_CODE[t]),this.buttons[t]?this.buttons[t].down:!1},getKeyUp:function(t){return"string"==typeof t&&(t=phina.input.Gamepad.BUTTON_CODE[t]),this.buttons[t]?this.buttons[t].up:!1},getKeyAngle:function(){var i=null,e=this.getKey("left")<<3|this.getKey("up")<<2|this.getKey("right")<<1|this.getKey("down");return 0!=e&&t.hasOwnProperty(e)&&(i=t[e]),i},getKeyDirection:function(){var t=phina.geom.Vector2(0,0);return this.getKey("left")?t.x=-1:this.getKey("right")&&(t.x=1),this.getKey("up")?t.y=-1:this.getKey("down")&&(t.y=1),t.x&&t.y&&t.div(Math.SQRT2),t},getStickAngle:function(t){t=t||0;var i=this.sticks[t];return i?Math.atan2(-i.y,i.x):null},getStickDirection:function(t){return t=t||0,this.sticks?this.sticks[t].clone():phina.geom.Vector2(0,0)},_updateState:function(t){this.id=t.id,this.connected=t.connected,this.mapping=t.mapping,this.timestamp=t.timestamp;for(var i=0,e=t.buttons.length;e>i;i++)this._updateButton(t.buttons[i],i);for(var n=0,s=t.axes.length;s>n;n+=2)this._updateStick(t.axes[n+0],n/2,"x"),this._updateStick(t.axes[n+1],n/2,"y")},_updateStateEmpty:function(){for(var t=0,i=this.buttons.length;i>t;t++)this.buttons[t].down=!1,this.buttons[t].up=!1},_updateButton:function(t,i){void 0===this.buttons[i]&&(this.buttons[i]={value:0,pressed:!1,last:!1,down:!1,up:!1});var e=this.buttons[i];e.last=e.pressed,"object"==typeof t?(e.value=t.value,e.pressed=t.pressed):(e.value=t,e.pressed=t>phina.input.Gamepad.ANALOGUE_BUTTON_THRESHOLD),e.down=(e.pressed^e.last)&e.pressed,e.up=(e.pressed^e.last)&e.last},_updateStick:function(t,i,e){void 0===this.sticks[i]&&(this.sticks[i]=phina.geom.Vector2(0,0)),this.sticks[i][e]=t},_static:{isAvailable:!!navigator.getGamepads||!!navigator.webkitGetGamepads,ANALOGUE_BUTTON_THRESHOLD:.5,BUTTON_CODE:{a:0,b:1,x:2,y:3,l1:4,r1:5,l2:6,r2:7,select:8,start:9,l3:10,r3:11,up:12,down:13,left:14,right:15,special:16,A:0,B:1,X:2,Y:3,L1:4,R1:5,L2:6,R2:7,SELECT:8,START:9,L3:10,R3:11,UP:12,DOWN:13,LEFT:14,RIGHT:15,SPECIAL:16}}});var t={0:null,1:270,2:0,4:90,8:180,6:45,3:315,12:135,9:225,14:90,13:180,11:270,7:0}}),phina.namespace(function(){phina.define("phina.app.Updater",{init:function(t){this.app=t},update:function(t){this._updateElement(t)},_updateElement:function(t){var i=this.app;if(t.awake!==!1){t.has("enterframe")&&t.flare("enterframe",{app:this.app}),t.update&&t.update(i);var e=t.children.length;if(t.children.length>0)for(var n=t.children.slice(),s=0;e>s;++s)this._updateElement(n[s])}},_checkPoint:function(t){this.app.pointers.forEach(function(i){null!==i.id&&this.__checkPoint(t,i)},this)},__checkPoint:function(t,i){if(t.interactive){var e=t._overFlags[i.id],n=t.hitTest2(i.x,i.y);t._overFlags[i.id]=n,!e&&n&&t.flare("pointover",{pointer:i}),e&&!n&&t.flare("pointout"),n&&i.getPointingStart()&&(t._touchFlags[i.id]=!0,t.flare("pointstart")),t._touchFlags[i.id]&&(t.flare("pointstay"),i._moveFlag&&t.flare("pointmove")),t._touchFlags[i.id]===!0&&i.getPointingEnd()&&(t._touchFlags[i.id]=!1,t.flare("pointend"),t._overFlags[i.id]&&(t._overFlags[i.id]=!1,t.flare("pointout")))}}})}),phina.namespace(function(){phina.define("phina.app.Interactive",{init:function(t){this.app=t,this._enable=!0},enable:function(){return this._enable=!0,this},disable:function(){return this._enable=!1,this},check:function(t){this._enable&&this._checkElement(t)},_checkElement:function(t){this.app;if(t.awake!==!1){this._checkPoint(t);var i=t.children.length;if(t.children.length>0)for(var e=t.children.slice(),n=0;i>n;++n)this._checkElement(e[n])}},_checkPoint:function(t){this.app.pointers.forEach(function(i){null!==i.id&&this.__checkPoint(t,i)},this)},__checkPoint:function(t,i){if(t.interactive){var e=t._overFlags[i.id],n=t.hitTest(i.x,i.y);t._overFlags[i.id]=n,!e&&n&&t.flare("pointover",{pointer:i}),e&&!n&&t.flare("pointout"),n&&i.getPointingStart()&&(t._touchFlags[i.id]=!0,t.flare("pointstart",{pointer:i}),t._clicked=!0),t._touchFlags[i.id]&&(t.flare("pointstay"),i._moveFlag&&t.flare("pointmove",{pointer:i})),t._touchFlags[i.id]===!0&&i.getPointingEnd()&&(t._touchFlags[i.id]=!1,t.flare("pointend"),t._overFlags[i.id]&&(t._overFlags[i.id]=!1,t.flare("pointout")))}}})}),phina.namespace(function(){phina.define("phina.app.BaseApp",{superClass:"phina.util.EventDispatcher",awake:null,fps:null,frame:null,init:function(t){this.superInit(),this._scenes=[phina.app.Scene()],this._sceneIndex=0,this.updater=phina.app.Updater(this),this.interactive=phina.app.Interactive(this),this.awake=!0,this.ticker=phina.util.Ticker()},run:function(){var t=this;return this.ticker.tick(function(){t._loop()}),this.ticker.start(),this},replaceScene:function(t){return this.currentScene&&(this.currentScene.app=null),this.currentScene=t,this.currentScene.app=this,this.currentScene.flare("enter",{app:this}),this},pushScene:function(t){return this.flare("push"),this.currentScene.flare("pause",{app:this}),this._scenes.push(t),++this._sceneIndex,this.flare("pushed"),t.app=this,t.flare("enter",{app:this}),this},popScene:function(){this.flare("pop");var t=this._scenes.pop();return--this._sceneIndex,t.flare("exit",{app:this}),t.app=null,this.flare("poped"),this.currentScene.flare("resume",{app:this,prevScene:t}),t},start:function(){return this.awake=!0,this},stop:function(){return this.awake=!1,this},enableStats:function(){if(phina.global.Stats)this.stats=new Stats,document.body.appendChild(this.stats.domElement);else{var t="https://cdnjs.cloudflare.com/ajax/libs/stats.js/r14/Stats.js",i=document.createElement("script");i.src=t,document.body.appendChild(i),i.onload=function(){this.enableStats()}.bind(this)}return this},_loop:function(){this._update(),this._draw(),this.stats&&this.stats.update()},_update:function(){this.awake&&(this.update&&this.update(),this.updater.update(this.currentScene),this.interactive.check(this.currentScene))},_draw:function(){},_accessor:{currentScene:{get:function(){return this._scenes[this._sceneIndex]},set:function(t){this._scenes[this._sceneIndex]=t}}}})}),phina.namespace(function(){phina.define("phina.app.Element",{superClass:"phina.util.EventDispatcher",parent:null,children:null,init:function(){this.superInit(),this.children=[]},addChild:function(t){return t.parent&&t.remove(),t.parent=this,this.children.push(t),t.has("added")&&t.flare("added"),t},addChildTo:function(t){return t.addChild(this),this},addChildAt:function(t,i){return t.parent&&t.remove(),t.parent=this,this.children.splice(i,0,t),t.has("added")&&t.flare("added"),t},getChildAt:function(t){return this.children.at(t)},getChildByName:function(t){},getChildIndex:function(t){return this.children.indexOf(t)},getParent:function(){return this.parent},getRoot:function(){var t=this;for(t=this.parent;null!=t.parent;t=t.parent);return t},removeChild:function(t){var i=this.children.indexOf(t);return-1!==i&&(this.children.splice(i,1),t.has("removed")&&t.flare("removed")),this},remove:function(){return this.parent?(this.parent.removeChild(this),this.parent=null,this):void 0},fromJSON:function(t){var i=function(t,i){var e=i.arguments;e=e instanceof Array?e:[e];var n=phina.using(i.className),s=n.apply(null,e);s.name=t,this[t]=s,s.fromJSON(i),s.addChildTo(this)}.bind(this);return t.forIn(function(t,e){"children"===t?e.forIn(function(t,e){i(t,e)}):"type"!==t&&(this[t]=e)},this),this},toJSON:function(){var t={},i=["x","y","rotation","scaleX","scaleY","originX","originY","className","name"];i.each(function(i){t[i]=this[i]},this);var e=this.children.map(function(t){return t.toJSON()});return e.length&&(t.children={},e.each(function(i){t.children[i.name]=i})),t}})}),phina.namespace(function(){phina.define("phina.app.Object2D",{superClass:"phina.app.Element",position:null,rotation:0,scale:null,origin:null,init:function(){this.superInit(),this.position=phina.geom.Vector2(0,0),this.scale=phina.geom.Vector2(1,1),this.origin=phina.geom.Vector2(.5,.5),this._matrix=phina.geom.Matrix33().identity(),this._worldMatrix=phina.geom.Matrix33().identity(),this.interactive=!1,this._overFlags={},this._touchFlags={}},hitTest:function(t,i){var e=this.globalToLocal(phina.geom.Vector2(t,i)),n=-this.width*this.originX,s=+this.width*(1-this.originX),a=-this.height*this.originY,r=+this.height*(1-this.originY);return n<e.x&&e.x<s&&a<e.y&&e.y<r},hitTestElement:function(t){var i=this,e=t;return i.left<e.right&&i.right>e.left&&i.top<e.bottom&&i.bottom>e.top},globalToLocal:function(t){var i=this._worldMatrix.clone();i.invert();var e=i.multiplyVector2(t);return e},setInteractive:function(t){return this.interactive=t,this},setX:function(t){return this.position.x=t,this},setY:function(t){return this.position.y=t,this},setPosition:function(t,i){return this.position.x=t,this.position.y=i,this},setRotation:function(t){return this.rotation=t,this},setScale:function(t,i){return this.scale.x=t,arguments.length<=1?this.scale.y=t:this.scale.y=i,this},setOrigin:function(t,i){return this.origin.x=t,this.origin.y=i,this},setWidth:function(t){return this.width=t,this},setHeight:function(t){return this.height=t,this},setSize:function(t,i){return this.width=t,this.height=i,this},_calcWorldMatrix:function(){if(this.parent){if(this.rotation!=this._cachedRotation){this._cachedRotation=this.rotation;var t=this.rotation*(Math.PI/180);this._sr=Math.sin(t),this._cr=Math.cos(t)}var i=this._matrix,e=this.parent._worldMatrix||phina.geom.Matrix33.IDENTITY,n=this._worldMatrix;i.m00=this._cr*this.scale.x,i.m01=-this._sr*this.scale.y,i.m10=this._sr*this.scale.x,i.m11=this._cr*this.scale.y,i.m02=this.position.x,i.m12=this.position.y;var s=i.m00,a=i.m01,r=i.m02,h=i.m10,o=i.m11,u=i.m12,c=e.m00,p=e.m01,l=e.m02,d=e.m10,f=e.m11,g=e.m12;return n.m00=c*s+p*h,n.m01=c*a+p*o,n.m02=c*r+p*u+l,n.m10=d*s+f*h,n.m11=d*a+f*o,n.m12=d*r+f*u+g,this}},_accessor:{x:{get:function(){return this.position.x},set:function(t){this.position.x=t}},y:{get:function(){return this.position.y},set:function(t){this.position.y=t}},originX:{get:function(){return this.origin.x},set:function(t){this.origin.x=t}},originY:{get:function(){return this.origin.y},set:function(t){this.origin.y=t}},scaleX:{get:function(){return this.scale.x},set:function(t){this.scale.x=t}},scaleY:{get:function(){return this.scale.y},set:function(t){this.scale.y=t}},width:{get:function(){return this._width},set:function(t){this._width=t}},height:{get:function(){return this._height},set:function(t){this._height=t}},radius:{get:function(){return void 0!==this._radius?this._radius:(this.width+this.height)/4},set:function(t){this._radius=t}},top:{get:function(){return this.y-this.height*this.originY},set:function(t){this.y=t+this.height*this.originY}},right:{get:function(){return this.x+this.width*(1-this.originX)},set:function(t){this.x=t-this.width*(1-this.originX)}},bottom:{get:function(){return this.y+this.height*(1-this.originY)},set:function(t){this.y=t-this.height*(1-this.originY)}},left:{get:function(){return this.x-this.width*this.originX},set:function(t){this.x=t+this.width*this.originX}},centerX:{get:function(){return this.x+this.width/2-this.width*this.originX},set:function(t){}},centerY:{get:function(){return this.y+this.height/2-this.height*this.originY},set:function(t){}}}})}),phina.namespace(function(){phina.define("phina.app.Scene",{superClass:"phina.app.Element",init:function(){this.superInit()},exit:function(t){if(this.app){if("object"!=typeof t){var i={};i.nextLabel=arguments[0],i.nextArguments=arguments[1],t=i}return t.nextLabel&&(this.nextLabel=t.nextLabel),t.nextArguments&&(this.nextArguments=t.nextArguments),this.app.popScene(),this}}})}),phina.namespace(function(){phina.define("phina.accessory.Accessory",{superClass:"phina.util.EventDispatcher",init:function(t){this.superInit(),this.target=t},setTarget:function(t){return this.target!==t?(this.target=t,this):void 0},getTarget:function(){return this.target},isAttached:function(){return!!this.target},attachTo:function(t){return t.attach(this),this.setTarget(t),this},remove:function(){this.target.detach(this),this.target=null}}),phina.app.Element.prototype.method("attach",function(t){return this.accessories||(this.accessories=[],this.on("enterframe",function(t){this.accessories.each(function(i){i.update&&i.update(t.app)})})),this.accessories.push(t),t.setTarget(this),t.flare("attached"),this}),phina.app.Element.prototype.method("detach",function(t){return this.accessories&&(this.accessories.erase(t),t.setTarget(null),t.flare("detached")),this})}),phina.namespace(function(){phina.define("phina.accessory.Tweener",{superClass:"phina.accessory.Accessory",init:function(t){this.superInit(t),this._loop=!1,this._init()},_init:function(){this._tasks=[],this._index=0,this.playing=!0,this._update=this._updateTask},update:function(t){this._update(t)},to:function(t,i,e){return this._add({type:"tween",mode:"to",props:t,duration:i,easing:e}),this},by:function(t,i,e){return this._add({type:"tween",mode:"by",props:t,duration:i,easing:e}),this},from:function(t,i,e){return this._add({type:"tween",mode:"from",props:t,duration:i,easing:e}),this},wait:function(t){return this._add({type:"wait",data:{limit:t}}),this},call:function(t,i,e){return this._add({type:"call",data:{func:t,self:i||this,args:e}}),this},set:function(t,i){var e=null;return 2==arguments.length?(e={},e[t]=i):e=t,this._tasks.push({type:"set",data:{values:e}}),this},moveTo:function(t,i,e,n){return this.to({x:t,y:i},e,n)},moveBy:function(t,i,e,n){return this.by({x:t,y:i},e,n)},fade:function(t,i,e){return this.to({alpha:t},i,e)},fadeOut:function(t,i){return this.fade(0,t,i)},fadeIn:function(t,i){return this.fade(1,t,i)},play:function(){return this.playing=!0,this},pause:function(){return this.playing=!1,this},stop:function(){return this.playing=!1,this.rewind(),this},rewind:function(){return this._update=this._updateTask,this._index=0,this.play(),this},yoyo:function(){return this._update=this._updateTask,this._index=0,this._tasks.each(function(t){"tween"===t.type}),this.play(),this},setLoop:function(t){return this._loop=t,this},clear:function(){return this._init(),this},fromJSON:function(t){return void 0!==t.loop&&this.setLoop(t.loop),t.tweens.each(function(t){var t=t.clone(),i=t.shift();this[i].apply(this,t)},this),this},_add:function(t){this._tasks.push(t)},_updateTask:function(t){if(this.playing){var i=this._tasks[this._index];if(!i)return void(this._loop?this.rewind():this.playing=!1);++this._index,"tween"===i.type?(this._tween=phina.util.Tween(),"to"===i.mode?this._tween.to(this.target,i.props,i.duration,i.easing):"by"===i.mode?this._tween.by(this.target,i.props,i.duration,i.easing):this._tween.from(this.target,i.props,i.duration,i.easing),this._update=this._updateTween,this._update(t)):"wait"===i.type?(this._wait={time:0,limit:i.data.limit},this._update=this._updateWait,this._update(t)):"call"===i.type?(i.data.func.apply(i.data.self,i.data.args),this._update(t)):"set"===i.type&&(this.target.$extend(i.data.values),this._update(t))}},_updateTween:function(t){var i=this._tween,e=t.ticker.deltaTime;i.time>=i.duration?(delete this._tween,this._tween=null,this._update=this._updateTask):i.forward(e)},_updateWait:function(t){var i=this._wait,e=t.ticker.deltaTime;i.time+=e,i.time>=i.limit&&(delete this._wait,this._wait=null,this._update=this._updateTask)}}),phina.app.Element.prototype.getter("tweener",function(){return this._tweener||(this._tweener=phina.accessory.Tweener().attachTo(this)),this._tweener})}),phina.namespace(function(){phina.define("phina.accessory.Draggable",{superClass:"phina.accessory.Accessory",init:function(t){this.superInit(t),this.initialPosition=phina.geom.Vector2(0,0);var i=this;this.on("attached",function(){this.target.setInteractive(!0),this.target.on("pointstart",function(t){i.initialPosition.x=this.x,i.initialPosition.y=this.y,i.flare("dragstart")}),this.target.on("pointmove",function(t){this.x+=t.pointer.dx,this.y+=t.pointer.dy,i.flare("drag")}),this.target.on("pointend",function(t){i.flare("dragend")})})},back:function(){this.target.x=this.initialPosition.x,this.target.y=this.initialPosition.y},enable:function(){this._enable=!0}}),phina.app.Element.prototype.getter("draggable",function(){return this._draggable||(this._draggable=phina.accessory.Draggable().attachTo(this)),this._draggable})}),phina.namespace(function(){phina.define("phina.accessory.FrameAnimation",{superClass:"phina.accessory.Accessory",init:function(t){this.superInit(),this.ss=phina.asset.AssetManager.get("spritesheet",t),this.paused=!0,this.finished=!1},update:function(){if(!this.paused&&this.currentAnimation){if(this.finished)return this.finished=!1,void(this.currentFrameIndex=0);++this.frame,this.frame%this.currentAnimation.frequency===0&&(++this.currentFrameIndex,this._updateFrame())}},gotoAndPlay:function(t){return this.frame=0,this.currentFrameIndex=0,this.currentAnimation=this.ss.getAnimation(t),this._updateFrame(),this.paused=!1,this},gotoAndStop:function(t){return this.frame=0,this.currentFrameIndex=0,this.currentAnimation=this.ss.getAnimation(t),this._updateFrame(),this.paused=!0,this},_updateFrame:function(){var t=this.currentAnimation;if(t&&this.currentFrameIndex>=t.frames.length)return t.next?void this.gotoAndPlay(t.next):(this.paused=!0,void(this.finished=!0));var i=t.frames[this.currentFrameIndex],e=this.ss.getFrame(i),n=this.target;n.srcRect.x=e.x,n.srcRect.y=e.y,n.srcRect.width=e.width,n.srcRect.height=e.height,n.width=e.width,n.height=e.height}})}),function(){phina.global.Event&&(Event.prototype.stop=function(){this.preventDefault(),this.stopPropagation()})}(),function(){phina.global.MouseEvent&&(MouseEvent.prototype.getter("pointX",function(){return this.clientX-this.target.getBoundingClientRect().left}),MouseEvent.prototype.getter("pointY",function(){return this.clientY-this.target.getBoundingClientRect().top}))}(),function(){phina.global.TouchEvent&&(TouchEvent.prototype.getter("pointX",function(){return this.touches[0].clientX-this.target.getBoundingClientRect().left}),TouchEvent.prototype.getter("pointY",function(){return this.touches[0].clientY-this.target.getBoundingClientRect().top}))}(),function(){phina.global.Touch&&(Touch.prototype.getter("pointX",function(){return this.clientX-this.target.getBoundingClientRect().left}),Touch.prototype.getter("pointY",function(){return this.clientY-this.target.getBoundingClientRect().top}))}(),phina.namespace(function(){phina.define("phina.graphics.Canvas",{domElement:null,canvas:null,context:null,init:function(t){"string"==typeof t?this.canvas=document.querySelector(t):this.canvas=t||document.createElement("canvas"),
this.domElement=this.canvas,this.context=this.canvas.getContext("2d"),this.context.lineCap="round",this.context.lineJoin="round"},setSize:function(t,i){return this.canvas.width=t,this.canvas.height=i,this},setSizeToScreen:function(){return this.canvas.style.position="fixed",this.canvas.style.margin="0px",this.canvas.style.padding="0px",this.canvas.style.left="0px",this.canvas.style.top="0px",this.setSize(window.innerWidth,window.innerHeight)},fitScreen:function(t){t=void 0===t?!0:t;var i=function(){var t=this.domElement,i=t.style;i.position="absolute",i.margin="auto",i.left="0px",i.top="0px",i.bottom="0px",i.right="0px";var e=t.width/window.innerWidth,n=t.height/window.innerHeight,s=t.height/t.width;e>n?(i.width=Math.floor(innerWidth)+"px",i.height=Math.floor(innerWidth*s)+"px"):(i.width=Math.floor(innerHeight/s)+"px",i.height=Math.floor(innerHeight)+"px")}.bind(this);i(),t&&window.addEventListener("resize",i,!1)},clear:function(t,i,e,n){return t=t||0,i=i||0,e=e||this.width,n=n||this.height,this.context.clearRect(t,i,e,n),this},clearColor:function(t,i,e,n,s){i=i||0,e=e||0,n=n||this.width,s=s||this.height;var a=this.context;return a.save(),a.setTransform(1,0,0,1,0,0),a.fillStyle=t,a.fillRect(i,e,n,s),a.restore(),this},beginPath:function(){return this.context.beginPath(),this},closePath:function(){return this.context.closePath(),this},moveTo:function(t,i){return this.context.moveTo(t,i),this},lineTo:function(t,i){return this.context.lineTo(t,i),this},fill:function(){return this.context.fill(),this},stroke:function(){return this.context.stroke(),this},clip:function(){return this.context.clip(),this},drawPoint:function(t,i){return this.strokeRect(t,i,1,1)},line:function(t,i,e,n){return this.moveTo(t,i).lineTo(e,n)},drawLine:function(t,i,e,n){return this.beginPath().line(t,i,e,n).stroke()},drawDashLine:function(t,i,e,n,s){var a=null;"string"==typeof s?a=s:(s=s||61680,a=s.toString(2)),a=a.padding(16,"1");var r=e-t,h=n-i,o=Math.sqrt(r*r+h*h);r/=o,h/=o;for(var u=t,c=i,p=0;o>p;++p)"1"==a[p%16]&&this.drawPoint(u,c),u+=r,c+=h;return this},drawArrow:function(t,i,e,n,s){var a=e-t,r=n-i,h=180*Math.atan2(r,a)/Math.PI;return this.drawLine(t,i,e,n),this.fillPolygon(e,n,s||5,3,h),this},lines:function(){this.moveTo(arguments[0],arguments[1]);for(var t=1,i=arguments.length/2;i>t;++t)this.lineTo(arguments[2*t],arguments[2*t+1]);return this},strokeLines:function(){return this.beginPath(),this.lines.apply(this,arguments),this.stroke(),this},fillLines:function(){return this.beginPath(),this.lines.apply(this,arguments),this.fill(),this},rect:function(t,i,e,n){return this.context.rect.apply(this.context,arguments),this},fillRect:function(){return this.context.fillRect.apply(this.context,arguments),this},strokeRect:function(){return this.context.strokeRect.apply(this.context,arguments),this},roundRect:function(t,i,e,n,s){var a=t+s,r=t+e-s,h=i+s,o=i+n-s;return this.context.arc(a,h,s,-Math.PI,.5*-Math.PI,!1),this.context.arc(r,h,s,.5*-Math.PI,0,!1),this.context.arc(r,o,s,0,.5*Math.PI,!1),this.context.arc(a,o,s,.5*Math.PI,Math.PI,!1),this.closePath(),this},fillRoundRect:function(t,i,e,n,s){return this.beginPath().roundRect(t,i,e,n,s).fill()},strokeRoundRect:function(t,i,e,n,s){return this.beginPath().roundRect(t,i,e,n,s).stroke()},circle:function(t,i,e){return this.context.arc(t,i,e,0,2*Math.PI,!1),this},fillCircle:function(t,i,e){var n=this.context;return n.beginPath(),n.arc(t,i,e,0,2*Math.PI,!1),n.closePath(),n.fill(),this},strokeCircle:function(t,i,e){var n=this.context;return n.beginPath(),n.arc(t,i,e,0,2*Math.PI,!1),n.closePath(),n.stroke(),this},arc:function(t,i,e,n,s,a){return this.context.arc(t,i,e,n,s,a),this},fillArc:function(t,i,e,n,s,a){return this.beginPath().arc(t,i,e,n,s,a).fill()},strokeArc:function(t,i,e,n,s,a){return this.beginPath().arc(t,i,e,n,s,a).stroke()},pie:function(t,i,e,n,s,a){var r=this.context;return r.beginPath(),r.moveTo(0,0),r.arc(t,i,e,n-Math.PI/2,s-Math.PI/2,a),r.closePath(),this},fillPie:function(t,i,e,n,s,a){return this.beginPath().pie(t,i,e,n,s,a).fill()},strokePie:function(t,i,e,n,s,a){return this.beginPath().pie(t,i,e,n,s,a).stroke()},polygon:function(t,i,e,n,s){var a=2*Math.PI/n,r=void 0!=s?s*Math.PI/180:-Math.PI/2;this.moveTo(t+Math.cos(r)*e,i+Math.sin(r)*e);for(var h=1;n>h;++h){var o=a*h+r;this.lineTo(t+Math.cos(o)*e,i+Math.sin(o)*e)}return this.closePath(),this},fillPolygon:function(t,i,e,n,s){return this.beginPath().polygon(t,i,e,n,s).fill()},strokePolygon:function(t,i,e,n,s){return this.beginPath().polygon(t,i,e,n,s).stroke()},star:function(t,i,e,n,s,a){var t=t||0,i=i||0,e=e||64,n=n||5,r=e*(s||.38),h=a?a*Math.PI/180:-Math.PI/2,o=2*Math.PI/n/2;this.moveTo(t+Math.cos(h)*e,i+Math.sin(h)*e);for(var u=1;2*n>u;++u){var c=o*u+h,p=u%2?r:e;this.lineTo(t+Math.cos(c)*p,i+Math.sin(c)*p)}return this.closePath(),this},fillStar:function(t,i,e,n,s,a){return this.beginPath().star(t,i,e,n,s,a).fill(),this},strokeStar:function(t,i,e,n,s,a){return this.beginPath().star(t,i,e,n,s,a).stroke(),this},setTransform:function(t,i,e,n,s,a){return this.context.setTransform(t,i,e,n,s,a),this},resetTransform:function(){return this.setTransform(1,0,0,1,0,0),this},transformCenter:function(){return this.context.setTransform(1,0,0,1,this.width/2,this.height/2),this},translate:function(t,i){return this.context.translate(t,i),this},rotate:function(t){return this.context.rotate(t),this},scale:function(t,i){return this.context.scale(t,i),this},_accessor:{width:{get:function(){return this.canvas.width},set:function(t){this.canvas.width=t}},height:{get:function(){return this.canvas.height},set:function(t){this.canvas.height=t}},fillStyle:{get:function(){return this.context.fillStyle},set:function(t){this.context.fillStyle=t}},strokeStyle:{get:function(){return this.context.strokeStyle},set:function(t){this.context.strokeStyle=t}}},_static:{dummyCanvas:function(){return phina.isNode()?null:document.createElement("canvas")}()}})}),phina.namespace(function(){phina.define("phina.graphics.CanvasRecorder",{superClass:"phina.util.EventDispatcher",init:function(t){this.superInit(),this.canvas=t,this.gif=new GIF({workers:4,quality:10,width:t.width,height:t.height})},start:function(){var t=33,i=0,e=setInterval(function(){i+=t,console.log(i),i>3e3&&clearInterval(e)},t);return this},stop:function(){},open:function(){}})}),phina.namespace(function(){phina.define("phina.display.CanvasElement",{superClass:"phina.app.Object2D",visible:!0,childrenVisible:!0,init:function(){this.superInit(),this.visible=!0,this.alpha=1,this._worldAlpha=1,this.width=64,this.height=64},setVisible:function(t){return this.visible=t,this},show:function(){return this.visible=!0,this},hide:function(){return this.visible=!1,this},_calcWorldAlpha:function(){if(!this.parent)return void(this._worldAlpha=this.alpha);var t=void 0!==this.parent._worldAlpha?this.parent._worldAlpha:1;this._worldAlpha=t*this.alpha}})}),phina.namespace(function(){phina.define("phina.display.Shape",{superClass:"phina.display.CanvasElement",init:function(t){this.superInit(),t=(t||{}).$safe({width:64,height:64,padding:8,backgroundColor:"#aaa"}),this.canvas=phina.graphics.Canvas(),this.style=phina.util.ChangeDispatcher(),this.style.register(t),this.style.onchange=function(){this._render()}.bind(this),this._render()},_render:function(){var t=this.style;this.canvas.width=t.width+2*t.padding,this.canvas.height=t.height+2*t.padding,this.canvas.clearColor(t.backgroundColor)},draw:function(t){var i=this.canvas.domElement,e=i.width,n=i.height;t.context.drawImage(i,0,0,e,n,-e*this.origin.x,-n*this.origin.y,e,n)}}),phina.define("phina.display.RectangleShape",{superClass:"phina.display.Shape",init:function(t){t=(t||{}).$safe({color:"blue",stroke:!0,strokeWidth:4,strokeColor:"#aaa",cornerRadius:0,backgroundColor:"transparent"}),this.superInit(t)},_render:function(){var t=this.style;this.canvas.width=t.width+2*t.padding,this.canvas.height=t.height+2*t.padding,this.canvas.clearColor(t.backgroundColor),this.canvas.transformCenter(),t.stroke&&(this.canvas.context.lineWidth=t.strokeWidth,this.canvas.strokeStyle=t.strokeColor,this.canvas.strokeRoundRect(-t.width/2,-t.height/2,t.width,t.height,t.cornerRadius)),this.canvas.context.fillStyle=t.color,this.canvas.fillRoundRect(-t.width/2,-t.height/2,t.width,t.height,t.cornerRadius)}}),phina.define("phina.display.CircleShape",{superClass:"phina.display.Shape",init:function(t){t=(t||{}).$safe({color:"red",radius:32,stroke:!0,strokeWidth:4,strokeColor:"#aaa",cornerRadius:0,backgroundColor:"transparent"}),this.superInit(t)},_render:function(){var t=this.style;this.canvas.width=2*t.radius+2*t.padding,this.canvas.height=2*t.radius+2*t.padding,this.canvas.clearColor(t.backgroundColor),this.canvas.transformCenter(),t.stroke&&(this.canvas.context.lineWidth=t.strokeWidth,this.canvas.strokeStyle=t.strokeColor,this.canvas.strokeCircle(0,0,t.radius)),this.canvas.context.fillStyle=t.color,this.canvas.fillCircle(0,0,t.radius)},_accessor:{radius:{get:function(){return this.style.radius},set:function(t){this.style.radius=t}}}})}),phina.namespace(function(){phina.define("phina.display.Sprite",{superClass:"phina.display.CanvasElement",init:function(t){this.superInit(),"string"==typeof t&&(t=phina.asset.AssetManager.get("image",t)),this.image=t,this.width=this.image.domElement.width,this.height=this.image.domElement.height,this.srcRect={x:0,y:0,width:this.width,height:this.height}},draw:function(t){var i=this.image.domElement,e=this.srcRect;t.context.drawImage(i,e.x,e.y,e.width,e.height,-this.width*this.originX,-this.height*this.originY,this.width,this.height)}})}),phina.namespace(function(){phina.define("phina.display.Label",{superClass:"phina.display.Shape",init:function(t,i){arguments.length>=2?i.text=t:i="string"==typeof arguments[0]?{text:t}:arguments[0],i=(i||{}).$safe({text:"Hello, world!",color:"black",stroke:!0,strokeColor:"#222",strokeWidth:2,fontSize:32,fontWeight:"",fontFamily:"'HiraKakuProN-W3'",shadowBlur:0,shadowColor:"black",align:"center",baseline:"middle",lineHeight:1.2,backgroundColor:"transparent"}),this.superInit(i)},calcWidth:function(){var t=0,i=this.canvas;return this._lines.forEach(function(e){var n=i.context.measureText(e).width;n>t&&(t=n)},this),"center"!==this.style.align&&(t*=2),t},calcHeight:function(){var t=this.style.fontSize*this._lines.length;return"middle"!==this.style.baseline&&(t*=2),t*this.style.lineHeight},_render:function(){var t=this.style,i=this.canvas,e=i.context,n=this.style.fontSize,s="{fontWeight} {fontSize}px {fontFamily}".format(this.style),a=this._lines=this.style.text.split("\n");i.context.font=s,i.width=this.calcWidth()+2*t.padding,i.height=this.calcHeight()+2*t.padding,i.clearColor(t.backgroundColor),i.transformCenter(),e.font=s,e.textAlign=this.style.align,e.textBaseline=this.style.baseline,e.fillStyle=this.style.color,e.strokeStyle=this.style.strokeColor,e.lineWidth=this.style.strokeWidth,e.lineJoin="round";var r=n*t.lineHeight,h=-Math.floor(a.length/2)*r;h+=(a.length+1)%2*(r/2),this.style.stroke&&(e.shadowBlur=0,a.forEach(function(t,i){e.strokeText(t,0,i*r+h)},this)),e.shadowBlur=this.style.shadowBlur,e.shadowColor=this.style.shadowColor,a.forEach(function(t,i){e.fillText(t,0,i*r+h)},this)},_accessor:{text:{get:function(){return this.style.text},set:function(t){this.style.text=t}}}})}),phina.namespace(function(){phina.define("phina.display.CanvasScene",{superClass:"phina.app.Scene",init:function(t){this.superInit(),t=(t||{}).$safe(phina.display.CanvasScene["default"]),this.canvas=phina.graphics.Canvas(),this.canvas.setSize(t.width,t.height),this.renderer=phina.display.CanvasRenderer(this.canvas),this.backgroundColor=t.backgroundColor?t.backgroundColor:null,this.width=t.width,this.height=t.height,this.gridX=phina.util.Grid(t.width,16),this.gridY=phina.util.Grid(t.height,16),this.interactive=!0,this._overFlags={},this._touchFlags={}},hitTest:function(){return!0},_update:function(){this.update&&this.update()},_render:function(){this.renderer.render(this)},_static:{"default":{width:640,height:960}}})}),phina.namespace(function(){phina.define("phina.display.Layer",{superClass:"phina.display.CanvasElement",childrenVisible:!1,init:function(t){this.superInit(t),this.canvas=phina.graphics.Canvas(),t=(t||{}).$safe({width:640,height:960}),this.width=this.canvas.width=t.width,this.height=this.canvas.height=t.height,this.renderer=phina.display.CanvasRenderer(this.canvas)},draw:function(t){var i=this._worldMatrix;this._worldMatrix=null,this.renderer.render(this),this._worldMatrix=i;var e=this.canvas.domElement;t.context.drawImage(e,0,0,e.width,e.height,-this.width*this.originX,-this.height*this.originY,this.width,this.height)}})}),phina.namespace(function(){phina.define("phina.display.ThreeLayer",{superClass:"phina.display.CanvasElement",scene:null,camera:null,light:null,renderer:null,childrenVisible:!1,init:function(t){this.superInit(),this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(75,t.width/t.height,1,1e4),this.camera.position.z=1e3,this.light=new THREE.DirectionalLight(16777215,1),this.light.position.set(1,1,1).normalize(),this.scene.add(this.light),this.renderer=new THREE.WebGLRenderer,this.renderer.setClearColor(15790320),this.renderer.setSize(t.width,t.height),this.on("enterframe",function(){this.renderer.render(this.scene,this.camera)})},draw:function(t){var i=this.renderer.domElement;t.context.drawImage(i,0,0,i.width,i.height)}})}),phina.namespace(function(){phina.define("phina.display.CanvasRenderer",{init:function(t){this.canvas=t,this._context=this.canvas.context},render:function(t){t.backgroundColor?this.canvas.clearColor(t.backgroundColor):this.canvas.clear(),this._context.save(),this.renderChildren(t),this._context.restore()},renderChildren:function(t){if(t.children.length>0)for(var i=t.children.slice(),e=0,n=i.length;n>e;++e)this.renderObject(i[e])},renderObject:function(t){if(t.visible!==!1){t._calcWorldMatrix&&t._calcWorldMatrix(),t._calcWorldAlpha&&t._calcWorldAlpha();var i=this.canvas.context;if(i.globalAlpha=t._worldAlpha,t._worldMatrix){var e=t._worldMatrix;i.setTransform(e.m00,e.m10,e.m01,e.m11,e.m02,e.m12)}if(t.clip){if(i.save(),t.clip(this.canvas),i.clip(),t.draw&&t.draw(this.canvas),t.childrenVisible&&t.children.length>0)for(var n=t.children.slice(),s=0,a=n.length;a>s;++s)this.renderObject(n[s]);i.restore()}else if(t.draw&&t.draw(this.canvas),t.childrenVisible&&t.children.length>0)for(var n=t.children.slice(),s=0,a=n.length;a>s;++s)this.renderObject(n[s])}}})}),phina.namespace(function(){phina.define("phina.display.DomApp",{superClass:"phina.app.BaseApp",domElement:null,init:function(t){this.superInit(t),t.domElement?this.domElement=t.domElement:t.query?this.domElement=document.querySelector(t.query):console.assert("error"),this.mouse=phina.input.Mouse(this.domElement),this.touch=phina.input.Touch(this.domElement),this.touchList=phina.input.TouchList(this.domElement,5),this.pointer=this.touch,this.pointers=this.touchList.touches,this.domElement.addEventListener("touchstart",function(){this.pointer=this.touch,this.pointers=this.touchList.touches}.bind(this)),this.domElement.addEventListener("mousedown",function(){this.pointer=this.mouse,this.pointers=[this.mouse]}.bind(this));var i=phina.isMobile()?"touchend":"mouseup";this.domElement.addEventListener(i,this._checkClick.bind(this)),this.domElement.addEventListener("touchstart",function(t){t.stop()}),this.domElement.addEventListener("touchmove",function(t){t.stop()})},update:function(){this.mouse.update(),this.touch.update(),this.touchList.update()},_checkClick:function(t){var i=function(t){t.children.length>0&&t.children.each(function(t){i(t)}),t._clicked&&t.has("click")&&t.flare("click"),t._clicked=!1};i(this.currentScene)}})}),phina.namespace(function(){phina.define("phina.display.CanvasApp",{superClass:"phina.display.DomApp",init:function(t){t.query||t.domElement||(t.domElement=document.createElement("canvas")),this.superInit(t),t.$safe({width:640,height:960,columns:12}),this.gridX=phina.util.Grid({width:t.width,columns:t.columns}),this.gridY=phina.util.Grid({width:t.height,columns:t.columns}),this.canvas=phina.graphics.Canvas(this.domElement),this.canvas.setSize(t.width,t.height),this.backgroundColor="white",this.replaceScene(phina.display.CanvasScene({width:t.width,height:t.height})),this.fitScreen(),this.on("push",function(){this._draw()})},_draw:function(){this.backgroundColor?this.canvas.clearColor(this.backgroundColor):this.canvas.clear(),this.currentScene.canvas&&(this.currentScene._render(),this._scenes.each(function(t){var i=t.canvas;i&&this.canvas.context.drawImage(i.domElement,0,0,i.width,i.height)},this))},fitScreen:function(){this.canvas.fitScreen()}})}),phina.namespace(function(){phina.define("phina.effect.Wave",{superClass:"phina.display.CircleShape",init:function(t){this.superInit({color:"white",stroke:!1});var i=phina.accessory.Tweener().attachTo(this);i.to({scaleX:2,scaleY:2,alpha:0},500).call(function(){this.remove()},this)}})}),phina.namespace(function(){phina.define("phina.ui.BaseButton",{superClass:"phina.display.CanvasElement",init:function(t){this.superInit(),t=(t||{}).$safe({width:200,height:80}),this.width=t.width,this.height=t.height,this.setInteractive(!0,"rect"),this.on("pointingend",function(){this.flare("push")})}})}),phina.namespace(function(){phina.define("phina.ui.Button",{superClass:"phina.ui.BaseButton",init:function(t){this.superInit(t),t=(t||{}).$safe({text:"Hello",color:"white",backgroundColor:"hsl(200, 80%, 60%)",cornerRadius:8,fontSize:32}),this.setInteractive(!0,"rect"),this.on("pointend",function(){this.flare("push")}),this.bg=phina.display.RectangleShape({width:this.width,height:this.height,cornerRadius:t.cornerRadius,color:t.backgroundColor,stroke:!1}).addChildTo(this),this.label=phina.display.Label(t.text,{color:t.color,stroke:!1,fontSize:t.fontSize}).addChildTo(this)}})}),phina.namespace(function(){phina.define("phina.ui.FlatButton",{superClass:"phina.display.CanvasElement",init:function(t){this.superInit(),t=t||{},t.$safe({width:200,height:80}),this.width=t.width,this.height=t.height,this.bg=phina.display.RectangleShape().addChildTo(this),this.bg.style.$extend({width:t.width,height:t.height}),this.label=phina.display.Label("hoge").addChildTo(this),this.setInteractive(!0,"rect")}})}),phina.namespace(function(){phina.define("phina.game.ManagerScene",{superClass:"phina.app.Scene",init:function(t){this.superInit(),this.setScenes(t.scenes),this.on("enter",function(){this.gotoScene(t.startLabel||0)}.bind(this)),this.on("resume",this.onnext.bind(this)),this.commonArguments={}},setScenes:function(t){return this.scenes=t,this.sceneIndex=0,this},gotoScene:function(t,i){t="string"==typeof t?this.labelToIndex(t):t||0,this.flare("prepare");var e=this.scenes[t],n=phina.using(e.className),s=e.arguments,s={}.$extend(s,i),a=n.call(null,s);return a.nextLabel||(a.nextLabel=e.nextLabel),a.nextArguments||(a.nextArguments=e.nextArguments),this.app.pushScene(a),this.sceneIndex=t,this.currentScene=a,this.flare("goto",{scene:a}),this},gotoNext:function(t){var i=this.scenes[this.sceneIndex],e=null;return i.nextLabel?e=this.labelToIndex(i.nextLabel):this.sceneIndex+1<this.scenes.length&&(e=this.sceneIndex+1),null!==e?this.gotoScene(e,t):this.fire(tm.event.Event("finish")),this},getCurrentIndex:function(){return this.sceneIndex},getCurrentLabel:function(){return this.scenes[this.sceneIndex].label},labelToIndex:function(t){var i=this.scenes.filter(function(i){return i.label==t})[0];return this.scenes.indexOf(i)},indexToLabel:function(t){return this.scenes[t].label},onnext:function(t){var i=t.prevScene.nextLabel,e=t.prevScene.nextArguments;i?this.gotoScene(i,e):this.gotoNext(e)}})}),phina.namespace(function(){phina.define("phina.game.SplashScene",{superClass:"phina.display.CanvasScene",init:function(t){this.superInit(t);var i=phina.game.SplashScene.defaults,e=phina.asset.Texture();e.load(i.imageURL).then(function(){this._init()}.bind(this)),this.texture=e},_init:function(){this.sprite=phina.display.Sprite(this.texture).addChildTo(this),this.sprite.setPosition(this.gridX.center(),this.gridY.center()),this.sprite.alpha=0,this.sprite.tweener.clear().to({alpha:1},500,"easeOutCubic").wait(1e3).to({alpha:0},500,"easeOutCubic").wait(250).call(function(){this.exit()},this)},_static:{defaults:{imageURL:"http://cdn.rawgit.com/phi-jp/phina.js/develop/logo.png"}}})}),phina.namespace(function(){phina.define("phina.game.TitleScene",{superClass:"phina.display.CanvasScene",init:function(t){this.superInit(t),t=(t||{}).$safe(phina.game.TitleScene.defaults),this.backgroundColor=t.backgroundColor,this.fromJSON({children:{titleLabel:{className:"phina.display.Label",arguments:[t.title,{color:t.fontColor,stroke:!1,fontSize:64}],x:this.gridX.center(),y:this.gridY.span(4)}}}),"touch"===t.exitType&&(this.fromJSON({children:{touchLabel:{className:"phina.display.Label",arguments:["TOUCH START",{color:"white",color:t.fontColor,stroke:!1,fontSize:32}],x:this.gridX.center(),y:this.gridY.span(12)}}}),this.on("pointstart",function(){this.exit()}))},_static:{defaults:{title:"phina.js games",message:"",width:640,height:960,fontColor:"white",backgroundColor:"hsl(200, 80%, 64%)",backgroundImage:"",exitType:"touch"}}})}),phina.namespace(function(){phina.define("phina.game.ResultScene",{superClass:"phina.display.CanvasScene",init:function(t){this.superInit(t),t=(t||{}).$safe(phina.game.ResultScene.defaults),this.backgroundColor=t.backgroundColor,this.fromJSON({children:{scoreText:{className:"phina.display.Label",arguments:["score",{color:t.fontColor,stroke:!1,fontSize:48}],x:this.gridX.span(8),y:this.gridY.span(4)},scoreLabel:{className:"phina.display.Label",arguments:[t.score+"",{color:t.fontColor,stroke:!1,fontSize:80}],x:this.gridX.span(8),y:this.gridY.span(6)},messageLabel:{className:"phina.display.Label",arguments:[t.message,{color:t.fontColor,stroke:!1,fontSize:32}],x:this.gridX.span(8),y:this.gridY.span(8)},shareButton:{className:"phina.ui.Button",arguments:[{text:"★",width:128,height:128,fontSize:50,cornerRadius:64}],x:this.gridX.span(6),y:this.gridY.span(11)},playButton:{className:"phina.ui.Button",arguments:[{text:"▶",width:128,height:128,fontSize:50,cornerRadius:64}],x:this.gridX.span(10),y:this.gridY.span(11),interactive:!0,onpush:function(){this.exit()}.bind(this)}}}),"touch"===t.exitType&&this.on("pointstart",function(){this.exit()}),this.shareButton.onclick=function(){var i=phina.social.Twitter.createURL({text:t.message,hashtags:t.hashtags});window.open(i,"share window","width=480, height=320")}},_static:{defaults:{score:16,message:"this is phina.js project.\n",hashtags:"phina,game,javascript",url:phina.global.location&&phina.global.location.href,width:640,height:960,fontColor:"white",backgroundColor:"hsl(200, 80%, 64%)",backgroundImage:""}}})}),phina.namespace(function(){phina.define("phina.game.LoadingScene",{superClass:"phina.display.CanvasScene",init:function(t){t=(t||{}).$safe(phina.game.LoadingScene.defaults),this.superInit(t),this.fromJSON({children:{bar:{className:"phina.display.Shape",arguments:{width:this.width,height:6,backgroundColor:"hsla(200, 100%, 80%, 0.8)"},originX:0,originY:0,x:0,y:0}}});var i=phina.asset.AssetLoader();this.bar.scaleX=0,i.onprogress=function(t){this.bar.scaleX=t.progress}.bind(this),i.onload=function(){"auto"===t.exitType&&this.app.popScene()}.bind(this),i.load(t.assets)},_static:{defaults:{width:640,height:960,exitType:"auto"}}})}),phina.namespace(function(){phina.define("phina.game.CountScene",{superClass:"phina.display.CanvasScene",init:function(t){this.superInit(t),t=(t||{}).$safe(phina.game.CountScene.defaults),this.backgroundColor=t.backgroundColor,this.fromJSON({children:{label:{className:"phina.display.Label",arguments:["",{color:"white",fontSize:t.fontSize,stroke:!1}],x:this.gridX.center(),y:this.gridY.center()}}}),t.count instanceof Array?this.countList=t.count.reverse():this.countList=Array.range(1,t.count+1),this.counter=this.countList.length,this.exitType=t.exitType,this._updateCount()},_updateCount:function(){var t=(this.counter<=0,--this.counter);this.label.text=this.countList[t],this.label.scale.set(1,1),this.label.tweener.clear().to({scaleX:1,scaleY:1,alpha:1},250).wait(500).to({scaleX:1.5,scaleY:1.5,alpha:0},250).call(function(){this.counter<=0?(this.flare("finish"),"auto"===this.exitType&&this.app.popScene()):this._updateCount()},this)},_static:{defaults:{count:3,width:640,height:960,fontColor:"white",fontSize:192,backgroundColor:null,exitType:"auto"}}})}),phina.namespace(function(){phina.define("phina.game.GameApp",{superClass:"phina.display.CanvasApp",init:function(t){this.superInit(t);var i=t.assets?"loading":t.startLabel,e=ManagerScene({startLabel:i,scenes:[{className:"LoadingScene",arguments:t,label:"loading",nextLabel:t.startLabel},{className:"SplashScene",arguments:t,label:"splash",nextLabel:"title"},{className:"TitleScene",arguments:t,label:"title",nextLabel:"main"},{className:"MainScene",arguments:t,label:"main",nextLabel:"result"},{className:"ResultScene",arguments:t,label:"result",nextLabel:"title"},{className:"PauseScene",arguments:t,label:"pause"}]});this.replaceScene(e)}})}),phina.namespace(function(){phina.define("phina.game.PieTimer",{superClass:"phina.display.Shape",init:function(t,i){i=(i||{}).$safe({color:"#aaa",radius:64,stroke:!0,strokeWidth:4,strokeColor:"#aaa",showPercentage:!1,backgroundColor:"transparent"}),this.superInit(i),this.label=phina.display.Label("hoge").addChildTo(this),this.time=0,this.limit=t||1e4,this.starting=!0},update:function(t){this.starting&&(this.time+=t.ticker.deltaTime)},start:function(){this.starting=!0},stop:function(){this.starting=!1},_render:function(){var t=this.style;this.canvas.width=2*t.radius+2*t.padding,this.canvas.height=2*t.radius+2*t.padding,this.canvas.clearColor(t.backgroundColor),this.canvas.transformCenter();var i=this.time/this.limit,e=2*Math.PI*i;if(t.stroke&&(this.canvas.context.lineWidth=t.strokeWidth,this.canvas.strokeStyle=t.strokeColor,this.canvas.strokeArc(0,0,t.radius,0-Math.PI/2,e-Math.PI/2)),this.canvas.context.fillStyle=t.color,this.canvas.fillPie(0,0,t.radius,0,e),this.label){var n=Math.max(0,this.limit-this.time);this.label.text=Math.ceil(n/1e3)+""}},_accessor:{time:{get:function(){return this._time},set:function(t){this._time=t,this._render()}}}})}),phina.namespace(function(){phina.define("phina.social.Twitter",{superClass:"phina.display.CircleShape",init:function(t){this.superInit({color:"white",stroke:!1});var i=phina.accessory.Tweener().attachTo(this);i.to({scaleX:2,scaleY:2,alpha:0},500).call(function(){this.remove()},this)},_static:{baseURL:"http://twitter.com/intent",defaults:{text:"Hello, world!",screen_name:"phi_jp",hashtags:"javascript,phina",url:phina.global.location&&phina.global.location.href,via:"phi_jp"},createURL:function(t){t=(t||{}).$safe(this.defaults);var i=[],e=encodeURIComponent;t.forIn(function(t,n){var s=t+"="+e(n);i.push(s)});var n="{baseURL}/{type}?{query}".format({baseURL:this.baseURL,type:"tweet",query:i.join("&")});return n}}})}),phina.namespace(function(){if(phina.global.Box2D){phina.box2d={b2:{Vec2:Box2D.Common.Math.b2Vec2,AABB:Box2D.Collision.b2AABB,BodyDef:Box2D.Dynamics.b2BodyDef,Body:Box2D.Dynamics.b2Body,FixtureDef:Box2D.Dynamics.b2FixtureDef,Fixture:Box2D.Dynamics.b2Fixture,World:Box2D.Dynamics.b2World,MassData:Box2D.Collision.Shapes.b2MassData,PolygonShape:Box2D.Collision.Shapes.b2PolygonShape,CircleShape:Box2D.Collision.Shapes.b2CircleShape,DebugDraw:Box2D.Dynamics.b2DebugDraw,MouseJointDef:Box2D.Dynamics.Joints.b2MouseJointDef}};var t=phina.box2d.b2;phina.define("phina.box2d.Box2dLayer",{superClass:"phina.display.Layer",init:function(i){this.superInit(i),i=(i||{}).$safe({worldScale:50});var e=new t.Vec2(0,9.8),n=new t.World(e,!0);this.world=n,this.world._scale=i.worldScale,this._setupDebugDraw()},_setupDebugDraw:function(){var i=new t.DebugDraw;i.SetSprite(this.canvas.context),i.SetDrawScale(this.world._scale),i.SetLineThickness(1),i.SetAlpha(1),i.SetFillAlpha(.4),i.SetFlags(t.DebugDraw.e_shapeBit),this.world.SetDebugDraw(i)},createBody:function(t){t.world=this.world;var i=phina.box2d.Box2dBody(t);return i},update:function(t){var i=t.ticker.deltaTime/1e3,e=10,n=10;this.world.Step(i,e,n)},draw:function(t){this.world.ClearForces(),this.world.DrawDebugData();var i=this.canvas.domElement;t.context.drawImage(i,0,0,i.width,i.height)}})}}),phina.namespace(function(){if(phina.global.Box2D){var t=phina.box2d.b2;phina.define("phina.box2d.Box2dBody",{superClass:"phina.accessory.Accessory",init:function(i){this.superInit(),this.world=i.world,this.type=i.type,this.shape=i.shape,this._init(),this.on("attached",function(){var i=this.target,e=new t.Vec2(i.x/this.world._scale,i.y/this.world._scale);this.body.SetPosition(e),this.body.SetAngle(i.rotation*Math.PI/180),this._bindFixture(this.target)})},update:function(t){var i=this.target;i.x=this.body.GetPosition().x*this.world._scale,i.y=this.body.GetPosition().y*this.world._scale,i.rotation=180*this.body.GetAngle()/Math.PI},_init:function(){return this._setupBody(),this},_setupBody:function(){var i=this,e=this.world,n=(e._scale,new t.BodyDef);n.type=function(){return{dynamic:t.Body.b2_dynamicBody,kinematic:t.Body.b2_kinematicBody,"static":t.Body.b2_staticBody}[i.type||"dynamic"]}(),n.position.Set(0,0);var s=e.CreateBody(n);return this.body=s,this},_bindFixture:function(){var i=this,e=this.target,n=this.body.GetFixtureList();n&&this.body.DestroyFixture(n);var s=this.world,a=s._scale,r=function(){var n=null;return"circle"===i.shape?n=new t.CircleShape(e.radius/a):"box"===i.shape?(n=new t.PolygonShape,n.SetAsBox(e.width/a/2,e.height/a/2)):n=new t.CircleShape(32/a),n}(),n=new t.FixtureDef;n.shape=r,n.density=1,n.friction=.3,n.restitution=.5,this.body.CreateFixture(n)}})}});